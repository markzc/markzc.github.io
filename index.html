<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.2" />






<meta name="description" content="Life was like a box of chocolates, you never know what you’re gonna get.">
<meta property="og:type" content="website">
<meta property="og:title" content="张冲'blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="张冲'blog">
<meta property="og:description" content="Life was like a box of chocolates, you never know what you’re gonna get.">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="张冲'blog">
<meta name="twitter:description" content="Life was like a box of chocolates, you never know what you’re gonna get.">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/"/>


  <title> 张冲'blog </title>
</head>

<body itemscope itemtype="//schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="//schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">张冲'blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/14/SVN/" itemprop="url">
                  SVN
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-09-14T21:01:00+08:00" content="2016-09-14">
              2016-09-14
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/SVN/" itemprop="url" rel="index">
                    <span itemprop="name">SVN</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/09/14/SVN/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/09/14/SVN/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/09/14/SVN/" class="leancloud_visitors" data-flag-title="SVN">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="SVN"><a href="#SVN" class="headerlink" title="SVN"></a>SVN</h1><h2 id="SVN的概述"><a href="#SVN的概述" class="headerlink" title="SVN的概述"></a>SVN的概述</h2><h3 id="SVN-的概述"><a href="#SVN-的概述" class="headerlink" title="SVN 的概述"></a>SVN 的概述</h3><p>  SVN简称Subversion的简称，是一个开放源码的版本控制系统，相较于RCS、CVS，它采用了分支管理系统，它的设计目标就是取代CVS。互联网上很多版本控制服务已从CVS迁移到Subversion.说的简单一点SVN就是用于多个人共同开发同一项目，共用资源的目的。</p>
<h3 id="SVN的作用"><a href="#SVN的作用" class="headerlink" title="SVN的作用"></a>SVN的作用</h3><p><img src="/uploads/SVN/wps5FFE.tmp.jpg" alt=""></p>
<h3 id="主流的版本控制"><a href="#主流的版本控制" class="headerlink" title="主流的版本控制"></a>主流的版本控制</h3><p>VSS ：Visual Source Safe  微软的<br>CVS<br>SVN : Apache的<br>Git :</p>
<h2 id="SVN的安装"><a href="#SVN的安装" class="headerlink" title="SVN的安装"></a>SVN的安装</h2><h3 id="SVN的使用的模式："><a href="#SVN的使用的模式：" class="headerlink" title="SVN的使用的模式："></a>SVN的使用的模式：</h3><p><img src="/uploads/SVN/wps3E98.tmp.jpg" alt=""></p>
<ul>
<li>SVN的使用模式：<ul>
<li>复制 –&gt; 修改 –&gt; 合并的方案（主要）</li>
<li>锁定 –&gt; 修改 –&gt; 解锁的方案</li>
</ul>
</li>
</ul>
<h3 id="SVN的体系"><a href="#SVN的体系" class="headerlink" title="SVN的体系"></a>SVN的体系</h3><p><img src="/uploads/SVN/wps2D4E.tmp.jpg" alt=""></p>
<h3 id="安装VisualSVN"><a href="#安装VisualSVN" class="headerlink" title="安装VisualSVN"></a>安装VisualSVN</h3><ul>
<li><p>注意端口，默认是443，很有可能被虚拟机占用，可以改为 8443(我用的8443),可以在命令行查看端口号 <code>netstat -ano</code></p>
</li>
<li><p>可以命令行里输入 <code>services.msc</code> 查看服务是否启动。</p>
</li>
</ul>
<h3 id="创建仓库，创建工程"><a href="#创建仓库，创建工程" class="headerlink" title="创建仓库，创建工程"></a>创建仓库，创建工程</h3><h2 id="SVN的基本的使用"><a href="#SVN的基本的使用" class="headerlink" title="SVN的基本的使用"></a>SVN的基本的使用</h2><h3 id="安装客户端软件"><a href="#安装客户端软件" class="headerlink" title="安装客户端软件"></a>安装客户端软件</h3><p>安装 <code>TortoiseSVN</code></p>
<h3 id="SVN的权限管理"><a href="#SVN的权限管理" class="headerlink" title="SVN的权限管理"></a>SVN的权限管理</h3><ul>
<li>在Users上创建用户<ul>
<li>右键Create User，输入用户名跟密码</li>
</ul>
</li>
<li>在Groups创建组，直接给用户名创建权限不太方便<ul>
<li>右键Create Group，输入用户名跟描述</li>
</ul>
</li>
<li>给组里添加用户<ul>
<li>选中组，右键Edit —&gt; Add.</li>
</ul>
</li>
<li>给仓库去设置权限<ul>
<li>仓库右键 Properties 设置权限</li>
</ul>
</li>
<li>在仓库中创建一个工程，内容一般放在<code>trunk</code>中，<code>branches</code>里放的是分支。</li>
</ul>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><blockquote>
<p>不同的步骤文件对应的图标会变</p>
</blockquote>
<ul>
<li>创建两个文件夹（A，B），分别作为要测试的仓库</li>
<li>右键 <code>CheckOut</code> 输入用户名密码，完成跟服务器同步<ul>
<li>若失败，想重新弄一下，需要 <code>右键 ---&gt; setting --&gt; clear Data</code> 清理一下缓存</li>
</ul>
</li>
<li>在A的一端可以创建一个文件，然后 <code>右键 ---&gt; TortoiseSVN ---&gt; Add</code><ul>
<li>现在只是添加到SVN的管理(文件图标有一个小加号)</li>
</ul>
</li>
<li>提交到SVN的服务器 <code>右键 ---&gt; SVN Commit...</code> (现在跟服务器上的代码是同步的文件图标有一个小对勾)</li>
</ul>
<hr>
<ul>
<li>B中要想在同步服务器中的东西，直接 <code>右键 ---&gt;update</code> 即可</li>
<li>在B的一段修改代码，文件会变成小叹号，表示与服务器端的不一样</li>
</ul>
<hr>
<ul>
<li>在A的一端，要先更新，<code>右键 ---&gt;update</code> ，写完了再提交</li>
<li>也可以恢复历史版本， <code>右键 ---&gt; TortoiseSVN ---&gt; Update to Revision...</code> 点 show log 恢复到指定的版本</li>
</ul>
<h3 id="解决冲突"><a href="#解决冲突" class="headerlink" title="解决冲突"></a>解决冲突</h3><ul>
<li>当两个人共同操作的时候，一个人已经提交了，另外一个人的就不是最新的版本了，他在提交的时候就不是最新的了，就会出现冲突</li>
<li>解决：出现冲突后，删掉没用的文件，把叹号里的东西没用的都删除，在提交即可<ul>
<li>还有一种方法，修改后，右键 —&gt; Resolve…(来标记冲突已经解决)</li>
</ul>
</li>
</ul>
<h2 id="SVN的-Eclipse-的插件"><a href="#SVN的-Eclipse-的插件" class="headerlink" title="SVN的 Eclipse 的插件"></a>SVN的 Eclipse 的插件</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><ul>
<li><p>低版本的跟MyEclipse：site中的两个文件夹拉出来放到一个叫做SVN文件夹中，然后扔到Eclipse里</p>
</li>
<li><p>现在使用的Eclipse中安装：</p>
<ul>
<li><code>Help ---&gt; Install new SoftWare ---&gt; add ---&gt; Archive ---&gt; SVN插件的地址</code></li>
<li>如果没有联网的话，把下边最后一个对勾去掉，否则不会成功</li>
<li>检查是否安装：右上角点开看是否有SCV资源库研究 或 右键项目 Team —&gt; Share Project 有SVN则成功了</li>
</ul>
</li>
</ul>
<h3 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h3><ul>
<li>发布一个项目<ul>
<li>在Eclipse中的SVN模块中，新建一个资源库的位置，路径为SVN服务器上要发布的地址，</li>
<li>项目 右键 —&gt; share Project —&gt; svn —&gt;选择已有的项目</li>
<li>再在项目，右键 —&gt; teap —&gt;提交</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>下载，检出<ul>
<li>在Eclipse中的SVN模块中，新建一个资源库的位置，路径为SVN服务器上要下载的地址。</li>
<li>则在这个路径底下就会有那个项目，在右键 —&gt; 检出为… —&gt; 输入项目名（注意不要重复）</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>使用<ul>
<li>先更新，右键 —&gt; team —&gt; 更新 ，  在改代码</li>
<li>在提交，右键 —&gt; team —&gt; 提交</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>删除项目<ul>
<li>因为项目已经被SVN管理，所以不要直接删除，要右键—&gt;断开连接，再删除</li>
<li>可以选择是否删除隐藏的 <code>.snv</code> 文件</li>
</ul>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/13/Spring第四阶段/" itemprop="url">
                  Spring第四阶段
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-13T20:24:46+08:00" content="2016-07-13">
              2016-07-13
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Spring/" itemprop="url" rel="index">
                    <span itemprop="name">Spring</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/13/Spring第四阶段/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/13/Spring第四阶段/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/07/13/Spring第四阶段/" class="leancloud_visitors" data-flag-title="Spring第四阶段">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h1><h2 id="案例：CRM的保存案例-SSH完成"><a href="#案例：CRM的保存案例-SSH完成" class="headerlink" title="案例：CRM的保存案例(SSH完成)"></a>案例：CRM的保存案例(SSH完成)</h2><h3 id="SSH-整合方式一：零障碍整合"><a href="#SSH-整合方式一：零障碍整合" class="headerlink" title="SSH 整合方式一：零障碍整合"></a>SSH 整合方式一：零障碍整合</h3><p>意思就是没有注解用所有的配置文件，最原始的那种写法</p>
<h4 id="SSH基本回顾"><a href="#SSH基本回顾" class="headerlink" title="SSH基本回顾"></a>SSH基本回顾</h4><h4 id="第一步：创建项目，引入jar包"><a href="#第一步：创建项目，引入jar包" class="headerlink" title="第一步：创建项目，引入jar包"></a>第一步：创建项目，引入jar包</h4><blockquote>
<p>33个</p>
</blockquote>
<ul>
<li>Struts2 中基本的开发包：struts-blanks中找  13个<ul>
<li>struts2中的依赖包(看需求)：<code>sturts/lib/</code><ul>
<li>例：<code>spring</code>  :Struts2整合Spring</li>
<li><code>convention</code> :注解</li>
<li><code>json</code>       :整合AJAX的开发包</li>
</ul>
</li>
</ul>
</li>
<li>Hibernate5 基本： <code>lib/required</code> 里面的所有9个<ul>
<li>还需要 日志记录 <code>log4j</code> 跟数据库驱动 <code>connector</code></li>
<li>有可能用的到数据库的连接池：<ul>
<li>C3P0 （3个）：5的版本，3的版本的时候只需要一个C3P0即可</li>
</ul>
</li>
</ul>
</li>
<li>Spring 基本：<ul>
<li><code>IOC</code>基本 6个，四个核心包，两个日志</li>
<li><code>AOP</code>基本 4个，两个核心包，两个依赖</li>
<li>事务管理 ：<code>tx</code></li>
<li>JDBC  :<code>jdbc</code>跟数据库驱动<code>connector</code></li>
<li>整合web  ：<code>web</code></li>
<li>整合单元测试   ：<code>test</code></li>
<li>整合其他框架（Hibernate反正在这）:  <code>orm</code></li>
</ul>
</li>
</ul>
<p><img src="/uploads/Spring/04/98000392-f432-4076-91a0-14af567b184a.png" alt=""><br>Struts跟Hibernate同时包含了这个，删除一个低版本的</p>
<h4 id="引入配置文件"><a href="#引入配置文件" class="headerlink" title="引入配置文件"></a>引入配置文件</h4><ul>
<li>Struts2<ul>
<li>web.xml</li>
<li>struts.xml</li>
</ul>
</li>
<li>Hibernate5<ul>
<li>hibernate.cfg.xml</li>
<li>映射文件</li>
</ul>
</li>
<li>Spring<ul>
<li>applicationContext.xml</li>
<li>log4j.properties</li>
<li>web.xml 核心监听器<code>ContextLoaderListener</code><br><img src="/uploads/Spring/04/88434362-b173-40e3-89c3-eb566df9bb47.png" alt=""></li>
</ul>
</li>
</ul>
<h4 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h4><ol>
<li>创建包结构</li>
<li>引入相关的页面</li>
<li>修改页面的路径</li>
</ol>
<h4 id="Struts2-和Spring的整合"><a href="#Struts2-和Spring的整合" class="headerlink" title="Struts2 和Spring的整合"></a>Struts2 和Spring的整合</h4><ul>
<li>Action类由Struts2的自身创建<ol>
<li>引入一个Struts2中的lib包中的<code>spring</code>包</li>
<li>在jar包中有一个配置文件：<code>struts-plugins.xml</code><ul>
<li>在struts核心包中的<code>default.properties</code>，有下面这个常量：<br><img src="/uploads/Spring/04/3d50191c-2892-4b3a-a777-cd7634a44526.jpg" alt=""></li>
<li><strong>Struts中的是默认将这个常量注释的，在插件包中将其开启，这个常量的开启会引发下面一系列常量的开启</strong></li>
<li>开启后只需要在action中加一个Service的变量跟set方法，即可直接使用Service，配置文件中只要有名字跟他对上了即可使用</li>
</ul>
</li>
</ol>
</li>
</ul>
<hr>
<ul>
<li>Action类交给Spring管理（建议使用）<ol>
<li>在Spring中创建一个Action的实例，</li>
<li>因为Struts配置文件中已经有了action的实例，所以需要把Struts中的class改为spring中实例的id<ul>
<li>注意：Actioin是多例的，所以要在Spring中的action实例中加一个<code>scope=prototyte</code></li>
<li>Service的属性需要在Spring中手动注入</li>
</ul>
</li>
</ol>
</li>
</ul>
<blockquote>
<p>建议使用交给Spring，因为Spring中有AOP，可以方便增强</p>
</blockquote>
<h4 id="Spring整合Hibernate"><a href="#Spring整合Hibernate" class="headerlink" title="Spring整合Hibernate"></a>Spring整合Hibernate</h4><ul>
<li>编写Dao，配置Dao</li>
<li><p>创建数据库和实体类，配置文件</p>
<ul>
<li>因为隔离级别跟绑定当前线程都交给Spring管了，所以在这里就把配置文件中的删掉。</li>
</ul>
</li>
<li><p>在Spring中引入Hibernate的信息</p>
<ol>
<li>在Spring的配置文件中构建一个<code>SessionFactory</code>（注意版本5）,并注入<code>configLoaction</code>属性<br><img src="/uploads/Spring/04/3fa14e71-7c2c-42ab-8a06-a7abbebff417.png" alt=""></li>
<li>定义Hibernate模板，并注入到Dao中去<br><img src="/uploads/Spring/04/8749312d-600e-422c-8900-bf5dd07a1c3f.jpg" alt=""><br><img src="/uploads/Spring/04/fb22de1e-96bd-4be9-be48-c11071795578.jpg" alt=""><br>然后在Dao中写模板的变量跟set方法即可。</li>
<li>因为写一个Dao就得注入一次，特麻烦，所以可以让Dao继承<code>HibernateDaoSupport</code>,里面有模板的变量跟set方法</li>
<li>还能更简单：<code>HibernateDaoSupport</code>中有<code>getHibernateTemplate</code>的方法，里面的内容是有模板就能用，没有就创建一个模板，所以只需要在Dao中注入<code>SessionFactory</code>,然后再调用<code>getHibernateTemplate</code>方法即可。</li>
</ol>
</li>
<li><p>在Spring跟Hibernate的整合上修改数据库时，必须使用事务管理，要不然会抛出<code>read-only</code>异常。</p>
</li>
</ul>
<h4 id="添加事务管理"><a href="#添加事务管理" class="headerlink" title="添加事务管理"></a>添加事务管理</h4><ul>
<li>配置事务管理器</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.orm.hibernate5.HibernateTransactionManager&quot;&gt;</div><div class="line">   &lt;property name=&quot;sesssionFactory&quot; ref=&quot;sessionFactory&quot; /&gt;</div><div class="line">&lt;/bean&gt;</div></pre></td></tr></table></figure>
<ul>
<li>开启注解事务</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;tx:annotation-driven transaction-manager=&quot;transactionManager&quot; /&gt;</div></pre></td></tr></table></figure>
<ul>
<li>在业务层添加注解</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">@Transactional</div><div class="line">public class CustomerServiceImpl implements CustomerService&#123;&#125;</div></pre></td></tr></table></figure>
<h3 id="SSH整合方式二：不带Hibernate配置文件"><a href="#SSH整合方式二：不带Hibernate配置文件" class="headerlink" title="SSH整合方式二：不带Hibernate配置文件"></a>SSH整合方式二：不带Hibernate配置文件</h3><p>web 项目复制之后过去不能直接用，必须修改项目属性中的 <code>Web Project Settings</code></p>
<h4 id="在Spring中配置连接池"><a href="#在Spring中配置连接池" class="headerlink" title="在Spring中配置连接池"></a>在Spring中配置连接池</h4><ul>
<li>提供属性文件（数据库连接）</li>
<li>引入外部属性文件<br><code>&lt;context:property-placeholder location=&quot;classspath:jdbc.properties&quot; /&gt;</code></li>
<li>配置连接池</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;bean id=&quot;dataSource&quot; class=&quot;com.mchange.v2.c3p0.ComboPooledDataSSource&quot;&gt;</div><div class="line">   &lt;property name=&quot;driverClass&quot; value=&quot;$&#123;jdbc.driverClass&#125;&quot;/&gt;</div><div class="line">   &lt;property name=&quot;jdbcUrl&quot; value=&quot;$&#123;jdbc.url&#125;&quot;/&gt;</div><div class="line">   &lt;property name=&quot;user&quot; value=&quot;$&#123;jdbc.user&#125;&quot;/&gt;</div><div class="line">   &lt;property name=&quot;password&quot; value=&quot;$&#123;jdbc.password&#125;&quot;/&gt;</div><div class="line">&lt;/bean&gt;</div></pre></td></tr></table></figure>
<ul>
<li>构建连接池，构建一个SessionFactory</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&lt;bean id=&quot;sessionFactory&quot; class=&quot;org.springframework.orm.hibernate5.LocalSessionFactoryBean&quot;&gt;</div><div class="line">   &lt;!--  注入连接池 --&gt;</div><div class="line">   &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot; /&gt;</div><div class="line">   &lt;!-- 设置Hibernate的属性 --&gt;</div><div class="line">   &lt;property name=&quot;hibernateProperties&quot;&gt;</div><div class="line">      &lt;props&gt;</div><div class="line">         &lt;prop key=&quot;hibernate.dialect&quot;&gt;org.hibernate.dialect.MySQLDialect&lt;/prop&gt;</div><div class="line">         &lt;prop key=&quot;hibernate.show_sql&quot;&gt;true&lt;/prop&gt;</div><div class="line">         &lt;prop key=&quot;hibernate.format_sql&quot;&gt;true&lt;/prop&gt;</div><div class="line">         &lt;prop key=&quot;hibernate.hbm2ddl.auto&quot;&gt;updata&lt;/prop&gt;</div><div class="line">      &lt;/props&gt;</div><div class="line">   &lt;/property&gt;</div><div class="line">&lt;/bean&gt;</div></pre></td></tr></table></figure>
<ul>
<li>设置Hibernate的映射文件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;property name=&quot;mappingResources&quot;&gt;</div><div class="line">   &lt;list&gt;</div><div class="line">     &lt;value&gt;com/spring/ssh/...&lt;/value&gt;</div><div class="line">   &lt;/list&gt;</div><div class="line">&lt;/property&gt;</div></pre></td></tr></table></figure>
<ul>
<li>在加载映射文件的时候还有很多种方式：<ul>
<li>具体到包中所有的映射文件 : <code>&lt;property name=&quot;mappingDirectoryLocations&quot;&gt; &lt;array&gt; &lt;value&gt;classpath:cn/itcast/domain&lt;/value&gt; &lt;/array&gt; &lt;/property&gt;</code> </li>
<li>使用通配符的概念加载映射文件 :<code>&lt;property name=&quot;mappingLocations&quot;&gt; &lt;array&gt; &lt;value&gt;classpath:cn/itcast/domain/*.hbm.xml&lt;/value&gt; &lt;/array&gt; &lt;/property&gt;</code></li>
</ul>
</li>
</ul>
<h3 id="Hibernation-模板的使用"><a href="#Hibernation-模板的使用" class="headerlink" title="Hibernation 模板的使用"></a>Hibernation 模板的使用</h3><ul>
<li>save(Object obj)</li>
<li>update(Object obj)</li>
<li>delete(Object obj)</li>
<li>T get(Class clazz,Serializable id);</li>
<li>List/<t> find(String hql);</t></li>
<li>List/<t> findByCriteria(DetachedCriteria c);</t></li>
</ul>
<h4 id="修改跟删除"><a href="#修改跟删除" class="headerlink" title="修改跟删除"></a>修改跟删除</h4><p><img src="/uploads/Spring/04/f6ad8db6-bab4-4841-879d-bf7a2b76d21c.png" alt=""></p>
<h4 id="查询一个"><a href="#查询一个" class="headerlink" title="查询一个"></a>查询一个</h4><p><img src="/uploads/Spring/04/f677f96f-3ef5-4c1d-b9da-32da897a63d2.png" alt=""></p>
<h4 id="查询多个"><a href="#查询多个" class="headerlink" title="查询多个"></a>查询多个</h4><p>HQL:<br><img src="/uploads/Spring/04/90ba5d38-f878-42df-aa1e-8d3c3474f795.png" alt=""></p>
<p>QBC:<br><img src="/uploads/Spring/04/181d9e3d-6a85-4064-bbed-ebcef1a0cbc4.png" alt=""></p>
<h3 id="延迟加载的解决"><a href="#延迟加载的解决" class="headerlink" title="延迟加载的解决"></a>延迟加载的解决</h3><ul>
<li><p>延迟加载问题：就是想用Load的时候，因为已经在service使用了事务，所以当延迟加载的时候，到Service的时候就把session关闭了，所以当action中用到查询的东西的时候，没有办法去获得数据了，就会报错</p>
</li>
<li><p>解决办法：用 <code>OpenSessionInViewFilter</code> 过滤器，把session的开启跟关闭放在action中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">  &lt;filter&gt;</div><div class="line">    &lt;filter-name&gt;OpenSessionInViewFilter&lt;/filter-name&gt;</div><div class="line">    &lt;filter-class&gt;org.springframework.orm.hibernate5.support.OpenSessionInViewFilter&lt;/filter-class&gt;</div><div class="line">  &lt;/filter&gt;</div><div class="line">  &lt;filter-mapping&gt;</div><div class="line">    &lt;filter-name&gt;OpenSessionInViewFilter&lt;/filter-name&gt;</div><div class="line">    &lt;url-pattern&gt;*.action&lt;/url-pattern&gt;</div><div class="line">  &lt;/filter-mapping&gt;</div></pre></td></tr></table></figure>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/08/Spring第三阶段/" itemprop="url">
                  Spring第三阶段
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-08T11:24:58+08:00" content="2016-07-08">
              2016-07-08
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Spring/" itemprop="url" rel="index">
                    <span itemprop="name">Spring</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/08/Spring第三阶段/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/08/Spring第三阶段/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/07/08/Spring第三阶段/" class="leancloud_visitors" data-flag-title="Spring第三阶段">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h1><h2 id="Spring的AOP的注解"><a href="#Spring的AOP的注解" class="headerlink" title="Spring的AOP的注解"></a>Spring的AOP的注解</h2><h3 id="AOP注解的入门"><a href="#AOP注解的入门" class="headerlink" title="AOP注解的入门"></a>AOP注解的入门</h3><ol>
<li>创建项目，引入jar包</li>
<li>创建接口跟实现类</li>
<li><p>将类的创建交给Spring</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;!-- 配置目标类--&gt;</div><div class="line">        &lt;bean id=&quot;customerDao&quot; class=&quot;com.itheima.aop.demo1.CustomerDaoImpl&quot;&gt;</div><div class="line">        &lt;/bean&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>编写切面类</p>
</li>
<li>开启AOP的注解 <code>&lt;aop:aspectj-autoproxy /&gt;</code></li>
<li>切面类的注解开发 <code>@Aspect</code></li>
<li>在方法上加注解<ul>
<li>前置增强 <code>@Before(value=&quot;execution(* com.spring...)&quot;)</code></li>
<li>后置增强,可以添加返回值 <code>@AfterReturning(value=&quot;execution(* com.spring...)&quot;,returning=&quot;obj&quot;)</code></li>
<li>环绕增 <code>@Around(value=&quot;execution(* com.spring...)&quot;)</code></li>
<li>异常捕获，可以获得异常信息 <code>@AfterThrowing(value=&quot;execution(* com.spring...)&quot;,throwing=&quot;ex&quot;)</code></li>
<li>最终增强 <code>@After(value=&quot;execution(* com.spring...)&quot;)</code></li>
</ul>
</li>
</ol>
<ul>
<li>可以把切入点注解提取出来，在最后加一个没有内容的方法，然后上面注解加这个，然后，上面的每一个方法上需要切入哪，只需要在value中加一个 <code>类名.方法名</code> 即可。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">@Pointcut(value=&quot;execution(* com.spring...)&quot;)</div><div class="line">private void pointCut01()&#123;&#125;</div></pre></td></tr></table></figure>
<h2 id="Spring的JDBC"><a href="#Spring的JDBC" class="headerlink" title="Spring的JDBC"></a>Spring的JDBC</h2><h3 id="Spring-的JDBC的模板"><a href="#Spring-的JDBC的模板" class="headerlink" title="Spring 的JDBC的模板"></a>Spring 的JDBC的模板</h3><p>Spring是EE开发的一站式框架，一站式框架就有每层的解决方案（包括持久层）。</p>
<h4 id="Spring的JDBC模板的入门"><a href="#Spring的JDBC模板的入门" class="headerlink" title="Spring的JDBC模板的入门"></a>Spring的JDBC模板的入门</h4><p>spring里面了很多对于持久层的解决方案。(JDBC,hibernate均有)</p>
<ol>
<li>创建项目，引入Spring的需要的jar包，还有Spring核心包中的两个包<code>jdbc</code>,<code>tx</code> 还有连接数据库的包 <code>connection</code>，Spring的版本还需要引入<code>AOP</code>的包</li>
<li>使用JDBC的模板</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">//创建连接池</div><div class="line">DriverManagerDataSource dataSource = new DriverManagerDataSource();</div><div class="line">//设置连接数据库的相关的参数</div><div class="line">dataSource.setDriverClassName(&quot;com.mysql.jdbc.Driver&quot;);</div><div class="line">dataSource.setUrl(&quot;jdbc:mysql:///数据库&quot;);</div><div class="line">dataSource.setUsername(&quot; &quot;);</div><div class="line">dataSource.setPassword(&quot; &quot;);</div><div class="line"></div><div class="line">JdbcTemplate jdbctemplate = new JdbcTemplate();</div><div class="line">JdbcTemplate.setDataSource(dataSource);</div><div class="line">jdbctemplate.update(&quot;sql语句&quot;,null,&quot;name&quot;,&quot;password&quot;);</div></pre></td></tr></table></figure>
<ul>
<li>这种方法是不好的，因为每次使用的时候还需要创建连接池，所以把连接池交给Spring管理</li>
</ul>
<h3 id="把连接池交给Spring管理"><a href="#把连接池交给Spring管理" class="headerlink" title="把连接池交给Spring管理"></a>把连接池交给Spring管理</h3><ul>
<li>创建xml配置文件，引入beans的约束</li>
<li>配置内置连接池</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;bean id=&quot;dataSource&quot; class=&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;&gt;</div><div class="line">  &lt;property name=&quot;driverClassName&quot; value=&quot;&quot; /&gt;</div><div class="line">  &lt;property name=&quot;url&quot; value=&quot;&quot; /&gt;</div><div class="line">  &lt;property name=&quot;username&quot; value=&quot;&quot; /&gt;</div><div class="line">  &lt;property name=&quot;password&quot; value=&quot;&quot; /&gt;</div><div class="line">&lt;/bean&gt;</div></pre></td></tr></table></figure>
<ul>
<li>把JDBC的模板交给Spring管理</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;bean id=&quot;jdbcTemplate&quot; class=&quot;jdbcTemplate的路劲&quot; &gt;</div><div class="line">    &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot; /&gt;</div><div class="line">&lt;/bean&gt;</div><div class="line">//这里的name必须为dataSource,因为用的是JDBC的模板</div></pre></td></tr></table></figure>
<ul>
<li>测试类：</li>
</ul>
<p>用JUnit跟Springde整合<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">@RunWith(SpringJUnit4ClassRunner.class)</div><div class="line">@contextConfiguration(&quot;classpath:applicationContext.xml&quot;)</div><div class="line">public class JdbcTemplateDemo2&#123;</div><div class="line">    @Resource(name=&quot;jdbcTemplate&quot;)</div><div class="line">    private JdbcTemplate jdbcTemplate;</div><div class="line">    </div><div class="line">    @Test</div><div class="line">    public void demo01()&#123;</div><div class="line">         jdbcTemplate.update(&quot;insert into account values (?,?)&quot;，&quot;张三&quot;，100d),;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="引入外界连接池"><a href="#引入外界连接池" class="headerlink" title="引入外界连接池"></a>引入外界连接池</h3><h4 id="dpcp连接池"><a href="#dpcp连接池" class="headerlink" title="dpcp连接池"></a>dpcp连接池</h4><ul>
<li>导包：依赖包中apache的commons中的dpcp跟pool，用之前的也行，跟这个一样</li>
<li>配置DBCP连接池</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">//配置DBCP的连接池</div><div class="line">&lt;bean id=&quot;dataSource&quot; class=&quot;org.apache.commons.dbcp.BasicDataSource&quot;&gt;</div><div class="line">  &lt;property name=&quot;driverClassName&quot; value=&quot;com.mysql,jdbc.Driver&quot; /&gt;</div><div class="line">  &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql:///数据库&quot; /&gt;</div><div class="line">  &lt;property name=&quot;username&quot; value=&quot;&quot; /&gt;</div><div class="line">  &lt;property name=&quot;password&quot; value=&quot;&quot; /&gt;</div><div class="line">&lt;/bean&gt;</div></pre></td></tr></table></figure>
<ul>
<li>测试跟默认的一样</li>
</ul>
<h4 id="c3p0的连接池"><a href="#c3p0的连接池" class="headerlink" title="c3p0的连接池"></a>c3p0的连接池</h4><ul>
<li>导包,依赖包中c3p0的包</li>
<li>配置连接池,注意：配置属性跟之前的不一样</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;bean id=&quot;dataSource&quot; class=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;&gt;</div><div class="line">  &lt;property name=&quot;driverClass&quot; value=&quot;com.mysql,jdbc.Driver&quot; /&gt;</div><div class="line">  &lt;property name=&quot;jdbcUrl&quot; value=&quot;jdbc:mysql:///数据库&quot; /&gt;</div><div class="line">  &lt;property name=&quot;user&quot; value=&quot;&quot; /&gt;</div><div class="line">  &lt;property name=&quot;password&quot; value=&quot;&quot; /&gt;</div><div class="line">&lt;/bean&gt;</div></pre></td></tr></table></figure>
<h3 id="提取属性文件-连接数据库的信息"><a href="#提取属性文件-连接数据库的信息" class="headerlink" title="提取属性文件(连接数据库的信息)"></a>提取属性文件(连接数据库的信息)</h3><p> 即使用配置文件，如果需要把项目交给别人也要改配置文件，所以提取出一个属性文件，改的时候只改属性文件即可</p>
<ul>
<li><p>定义属性文件<code>jdbc.properties</code><br><img src="/uploads/Spring/03/f6d4d0c3-a12a-4180-92bc-2432f079d957.jpg" alt=""></p>
</li>
<li><p>在Spring中配置文件引入属性文件：</p>
</li>
</ul>
<ol>
<li>通过<code>&lt;bean&gt;</code>引入<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;bean  class=&quot;org.springframework.beans.factory.config.PropertyPlaceholderConfigurer&quot;&gt;</div><div class="line">    &lt;property name=&quot;location&quot; value=&quot;classpath:jdbc.prorerties&quot;&gt;</div><div class="line">&lt;/bean&gt;</div></pre></td></tr></table></figure>
</li>
</ol>
<p>在配置配置文件:<br><img src="/uploads/Spring/03/74842d83-52cf-4660-a8ae-d5c499e0e8a8.jpg" alt=""></p>
<ol>
<li>但不经常用这个，经常用context标签引入<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;context:property-placeholder location=&quot;classpath:jdbc.prorerties&quot;&gt;</div><div class="line">&lt;!--  配置C3P0连接池 --&gt;</div><div class="line">&lt;bean id=&quot;dataSource&quot; class=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;&gt;</div><div class="line">   &lt;property name=&quot;driverClass&quot; value=&quot;$&#123;jdbc.driverClass&#125;&quot; /&gt;</div><div class="line">   &lt;property name=&quot;jdbcUrl&quot; value=&quot;$&#123;jdbc.url&#125;&quot; /&gt;</div><div class="line">   &lt;property name=&quot;user&quot; value=&quot;$&#123;jdbc.user&#125;&quot; /&gt;</div><div class="line">   &lt;property name=&quot;password&quot; value=&quot;$&#123;jdbc.password&#125;&quot; /&gt;</div><div class="line">&lt;/bean&gt;</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="JDBC模板进行CURD操作"><a href="#JDBC模板进行CURD操作" class="headerlink" title="JDBC模板进行CURD操作"></a>JDBC模板进行CURD操作</h3><h4 id="增删改"><a href="#增删改" class="headerlink" title="增删改"></a>增删改</h4><ul>
<li>增删改的方法是通用的：<ul>
<li>update(sql语句，参数);</li>
</ul>
</li>
</ul>
<p><img src="/uploads/Spring/03/071254a2-91d5-459b-9017-7ac437310176.jpg" alt=""></p>
<h4 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h4><ul>
<li>单个数 : <code>T queryForObject(String sql,Class/&lt;T/&gt; requiredType,Object… args)</code> </li>
<li>某个对象 ：<code>T queryForObject(String sql,RowMapper/&lt;T/&gt; rowMapper ,Object… args);</code></li>
<li>List集合 ：<code>List/&lt;T/&gt; query(String sql,RowMapper/&lt;T/&gt; rowMapper,Object… args);</code></li>
</ul>
<ul>
<li><p>查询属性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//查询id为1的账号的名称</div><div class="line">String name=jdbcTemplate.queryForObject(sql语句，String.class,Object 参数);</div></pre></td></tr></table></figure>
</li>
<li><p>统计个数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Long count=jdbcTemplate.queryForObject(sql语句，Long.class,Object 参数);</div></pre></td></tr></table></figure>
</li>
<li><p>查询某个对象</p>
<ul>
<li>RowMapper类似于DBUtils中的 ResultSetHandler</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">Account account=jdbcTemplate.queryForObject(sql语句，new MyRowMapper(),参数);</div><div class="line"></div><div class="line">//可以创建一个内部类来实现RowMapper&lt;T&gt;</div><div class="line">class MyRowMapper implements RowMapper&lt;User&gt;&#123;</div><div class="line">   @override</div><div class="line">   public Account mapRow(ResultSet rs,int rowNum)&#123;</div><div class="line">       Account account = new Account();</div><div class="line">       account.setId(rs.getInt(&quot;id&quot;));</div><div class="line">       account.setName(rs.getString(&quot;name&quot;));</div><div class="line">       account.setMoney(rs.getDouble(&quot;money&quot;));</div><div class="line">       return account;</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>查询多个对象</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">List&lt;Account&gt; account = query(String sql,new MyRowMapper(),Object... args);</div><div class="line">//当然也需要创建一个RowMapper&lt;T&gt;接口的实现类，跟上边用一个就行</div></pre></td></tr></table></figure>
<h2 id="Spring的事务"><a href="#Spring的事务" class="headerlink" title="Spring的事务"></a>Spring的事务</h2><h3 id="Spring的事务管理"><a href="#Spring的事务管理" class="headerlink" title="Spring的事务管理"></a>Spring的事务管理</h3><h4 id="事务的回顾"><a href="#事务的回顾" class="headerlink" title="事务的回顾"></a>事务的回顾</h4><ul>
<li>事务的概念：<ul>
<li>逻辑上一组操作，组成这组操作的各个逻辑单元，要么一起成功，要么一起失败</li>
</ul>
</li>
<li>事务的特性：<ul>
<li>原子性</li>
<li>一致性</li>
<li>隔离性</li>
<li>持久性</li>
</ul>
</li>
<li>如果不考虑隔离性引发安全问题<ul>
<li>读问题<ul>
<li>脏读</li>
<li>不可重复读</li>
<li>虚读</li>
</ul>
</li>
<li>写问题<ul>
<li>丢失更新</li>
</ul>
</li>
</ul>
</li>
<li>解决读问题<ul>
<li>设置事务隔离级别<ul>
<li>read uncommitted</li>
<li>read committed</li>
<li>repeatable read</li>
<li>serializable</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="Spring的事务管理的API"><a href="#Spring的事务管理的API" class="headerlink" title="Spring的事务管理的API"></a>Spring的事务管理的API</h4><ul>
<li>PlatformTransactionManager：平台事务管理器（Spring中真正管理事务的对象）<ul>
<li><code>DataSourceTransactionManager</code> ：使用JDBC操作进行事务管理时候使用</li>
<li><code>HibernateTransactionManager</code>  ：使用Hibernate框架进行事务管理时候使用</li>
</ul>
</li>
<li>TransactionDefinition  ：事务的定义信息<ul>
<li>事务的隔离级别</li>
<li><strong>事务的传播行为</strong></li>
<li>事务是否只读</li>
<li>事务超时信息</li>
</ul>
</li>
<li>TransactionStatus ：事务的状态对象<ul>
<li>是否已经完成</li>
<li>是否有保存点</li>
</ul>
</li>
<li>三个对象的关系：<ul>
<li>Spring通过TransactionDefinition对事务进行定义，使用PlatformTransactionManager根据定义信息进行事务的管理，在事务管理过程中产生一些状态，将状态存入到TransactionStatus中。</li>
</ul>
</li>
</ul>
<h4 id="事务的传播行为的作用和含义"><a href="#事务的传播行为的作用和含义" class="headerlink" title="事务的传播行为的作用和含义"></a>事务的传播行为的作用和含义</h4><ul>
<li><p>事务传播行为的作用</p>
<ul>
<li>事务的传播行为：解决复杂的事务的操作，业务层之间代码的相互调用 propagation<br><img src="/uploads/Spring/03/e5f13905-f1f6-43d3-9a1f-07ede5359336.png" alt=""></li>
</ul>
</li>
<li><p>事务传播行为的取值：记标红的那个即可，主要是第一个<br><img src="/uploads/Spring/03/5fdc6a65-8834-49cb-aec0-75cf62a16f9d.jpg" alt=""><br>根据上两幅图做出的解释：<br><img src="/uploads/Spring/03/3de2087d-aaa0-4d89-b974-da5ccb3b76a0.jpg" alt=""></p>
</li>
</ul>
<h4 id="Spring的事务管理的方式"><a href="#Spring的事务管理的方式" class="headerlink" title="Spring的事务管理的方式"></a>Spring的事务管理的方式</h4><ul>
<li>编程式事务管理： 手动编写代码实现事务管理</li>
<li><strong>声明式事务管理</strong>： 通过配置实现事务管理<ul>
<li>xml的配置方式</li>
<li>注解方式</li>
</ul>
</li>
</ul>
<h3 id="Spring的事务管理实现："><a href="#Spring的事务管理实现：" class="headerlink" title="Spring的事务管理实现："></a>Spring的事务管理实现：</h3><h4 id="搭建事务管理的基本环境"><a href="#搭建事务管理的基本环境" class="headerlink" title="搭建事务管理的基本环境"></a>搭建事务管理的基本环境</h4><p>用转账的案例，先写出JDBC模板：</p>
<ul>
<li>编写Dao</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">public class AccountDaoImpl implements AccountDao &#123;</div><div class="line">    </div><div class="line">    private JdbcTemplate jdbcTemplate;</div><div class="line">    </div><div class="line">    public void setJdbcTemplate(JdbcTemplate jdbcTemplate) &#123;</div><div class="line">        this.jdbcTemplate = jdbcTemplate;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void outMoney(String from, Double money) &#123;</div><div class="line">        jdbcTemplate.update(&quot;update account set money = money - ? where name = ?&quot;, money,from);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void inMoney(String to, Double money) &#123;</div><div class="line">        jdbcTemplate.update(&quot;update account set money = money + ? where name = ?&quot;, money,to);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>配置Dao</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&lt;!-- 引入外部属性文件：方式二：通过context标签引入 --&gt;</div><div class="line">    &lt;context:property-placeholder location=&quot;classpath:jdbc.properties&quot;/&gt;</div><div class="line">    &lt;!-- 配置C3P0连接池 --&gt;</div><div class="line">    &lt;bean id=&quot;dataSource&quot; class=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;&gt;</div><div class="line">        &lt;property name=&quot;driverClass&quot; value=&quot;$&#123;jdbc.driverClass&#125;&quot;/&gt;</div><div class="line">        &lt;property name=&quot;jdbcUrl&quot; value=&quot;$&#123;jdbc.url&#125;&quot;/&gt;</div><div class="line">        &lt;property name=&quot;user&quot; value=&quot;$&#123;jdbc.user&#125;&quot;/&gt;</div><div class="line">        &lt;property name=&quot;password&quot; value=&quot;$&#123;jdbc.password&#125;&quot;/&gt;</div><div class="line">    &lt;/bean&gt;</div><div class="line">    </div><div class="line">    &lt;!-- 将JDBC的模板交给Spring管理 --&gt;</div><div class="line">    &lt;bean id=&quot;jdbcTemplate&quot; class=&quot;org.springframework.jdbc.core.JdbcTemplate&quot;&gt;</div><div class="line">        &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt;</div><div class="line">    &lt;/bean&gt;</div><div class="line">    </div><div class="line">    &lt;!-- 配置DAO --&gt;</div><div class="line">    &lt;bean id=&quot;accountDao&quot; class=&quot;com.itheima.tx.demo1.AccountDaoImpl&quot;&gt;</div><div class="line">        &lt;property name=&quot;jdbcTemplate&quot; ref=&quot;jdbcTemplate&quot;/&gt;</div><div class="line">    &lt;/bean&gt;</div></pre></td></tr></table></figure>
<ul>
<li>编写Service</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">public class AccountServiceImpl implements AccountService &#123;</div><div class="line"></div><div class="line">    private AccountDao accountDao;</div><div class="line">    </div><div class="line">    public void setAccountDao(AccountDao accountDao) &#123;</div><div class="line">        this.accountDao = accountDao;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    /**</div><div class="line">     * from：转出账号</div><div class="line">     * to：转入账号</div><div class="line">     * money：转账金额</div><div class="line">     */</div><div class="line">    public void transfer(String from, String to, Double money) &#123;</div><div class="line">        accountDao.outMoney(from, money);</div><div class="line">        accountDao.inMoney(to, money);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>配置Service</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;!-- 配置Service --&gt;</div><div class="line">    &lt;bean id=&quot;accountService&quot; class=&quot;com.itheima.tx.demo1.AccountServiceImpl&quot;&gt;</div><div class="line">        &lt;property name=&quot;accountDao&quot; ref=&quot;accountDao&quot;/&gt;</div><div class="line">    &lt;/bean&gt;</div></pre></td></tr></table></figure>
<ul>
<li>编写测试类</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">@RunWith(SpringJUnit4ClassRunner.class)</div><div class="line">@ContextConfiguration(&quot;classpath:applicationContext2.xml&quot;)</div><div class="line">public class TransactionDemo1 &#123;</div><div class="line">    @Resource(name=&quot;accountService&quot;)</div><div class="line">    private AccountService accountService;</div><div class="line">    </div><div class="line">    @Test</div><div class="line">    public void demo1()&#123;</div><div class="line">        accountService.transfer(&quot;郝强勇&quot;, &quot;郝如花&quot;, 1000d);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="编程式事务管理"><a href="#编程式事务管理" class="headerlink" title="编程式事务管理"></a>编程式事务管理</h4><ul>
<li>配置事务管理器:  <strong>注</strong>：事务管理器的名称必须是<code>transactionManager</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;!-- 配置事务管理器：Spring真正管理事务的类 --&gt;</div><div class="line">    &lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;</div><div class="line">        &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt;</div><div class="line">    &lt;/bean&gt;</div></pre></td></tr></table></figure>
<ul>
<li>配置事务管理模板</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">//配置事务管理的模板</div><div class="line">&lt;bean id=&quot;transactionTemplate&quot; class=&quot;org.springframework.transaction.support.TransactionTemplate&quot;&gt;   &lt;property name=&quot;transactionManager&quot; ref=&quot;transactionManager&quot; /&gt;</div><div class="line">&lt;/bean&gt;</div></pre></td></tr></table></figure>
<ul>
<li>在业务层注入事务管理的模板</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;!-- 配置Service --&gt;</div><div class="line">    &lt;bean id=&quot;accountService&quot; class=&quot;com.itheima.tx.demo1.AccountServiceImpl&quot;&gt;</div><div class="line">        &lt;property name=&quot;accountDao&quot; ref=&quot;accountDao&quot;/&gt;</div><div class="line">        &lt;!-- 事务管理模板的注入 --&gt;</div><div class="line">        &lt;property name=&quot;transactionTemplate&quot; ref=&quot;transactionTemplate&quot;/&gt;</div><div class="line">    &lt;/bean&gt;</div></pre></td></tr></table></figure>
<ul>
<li>改写业务层</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">public class AccountServiceImpl implements AccountService &#123;</div><div class="line"></div><div class="line">    private AccountDao accountDao;</div><div class="line">    </div><div class="line">    public void setAccountDao(AccountDao accountDao) &#123;</div><div class="line">        this.accountDao = accountDao;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    // 提供事务管理模板注入:</div><div class="line">    private TransactionTemplate transactionTemplate;</div><div class="line">    public void setTransactionTemplate(TransactionTemplate transactionTemplate) &#123;</div><div class="line">        this.transactionTemplate = transactionTemplate;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    /**</div><div class="line">     * from：转出账号</div><div class="line">     * to：转入账号</div><div class="line">     * money：转账金额</div><div class="line">     */</div><div class="line">    public void transfer(final String from, final String to, final Double money) &#123;</div><div class="line">        transactionTemplate.execute(new TransactionCallbackWithoutResult() &#123;</div><div class="line">            @Override</div><div class="line">            protected void doInTransactionWithoutResult(TransactionStatus status) &#123;</div><div class="line">                accountDao.outMoney(from, money);</div><div class="line">                int d = 1/ 0;</div><div class="line">                accountDao.inMoney(to, money);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    </div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="声明式事务管理-底层用的就是AOP"><a href="#声明式事务管理-底层用的就是AOP" class="headerlink" title="声明式事务管理(底层用的就是AOP)"></a>声明式事务管理(底层用的就是AOP)</h4><h5 id="XML方式"><a href="#XML方式" class="headerlink" title="XML方式"></a>XML方式</h5><ul>
<li>引入Aop的jar包</li>
<li>恢复一下转账的环境</li>
<li><p>配置事务管理器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;!-- 配置事务管理器 --&gt;</div><div class="line">    &lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;</div><div class="line">        &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt;</div><div class="line">    &lt;/bean&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>配置事务的增强（规范）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&lt;!-- 配置事务的增强（规范） --&gt;</div><div class="line">    &lt;tx:advice id=&quot;txAdvice&quot; transaction-manager=&quot;transactionManager&quot;&gt;</div><div class="line">        &lt;tx:attributes&gt;</div><div class="line">            &lt;!-- &lt;tx:method name=&quot;save*&quot; propagation=&quot;REQUIRED&quot; /&gt;</div><div class="line">            &lt;tx:method name=&quot;update*&quot; propagation=&quot;REQUIRED&quot; /&gt;</div><div class="line">            &lt;tx:method name=&quot;find*&quot; read-only=&quot;true&quot;/&gt; --&gt;</div><div class="line">            &lt;tx:method name=&quot;transfer&quot; propagation=&quot;REQUIRED&quot;/&gt;</div><div class="line">        &lt;/tx:attributes&gt;</div><div class="line">    &lt;/tx:advice&gt;</div><div class="line"></div><div class="line">//propagaion :传播行为</div><div class="line">isolation :隔离级别</div><div class="line">read-only :是否为只读</div><div class="line">rollback-for :发生哪些异常事务会回滚，默认情况下，任何异常都会回滚</div><div class="line">no-rollback-for :发生哪些异常事务不会回滚</div></pre></td></tr></table></figure>
</li>
<li><p>AOP的配置</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"> &lt;!-- AOP的配置--&gt;</div><div class="line">    &lt;aop:config&gt;</div><div class="line">      &lt;aop:pointcut expression=&quot;execution(* com.itheima.tx.demo2.AccountServiceImpl.transfer(..))&quot;  id=&quot;pointcut1&quot;/&gt;</div><div class="line">     &lt;aop:advisor advice-ref=&quot;txAdvice&quot; pointcut-ref=&quot;pointcut1&quot;/&gt;</div><div class="line">    &lt;/aop:config&gt;</div></pre></td></tr></table></figure>
<h5 id="注解方式"><a href="#注解方式" class="headerlink" title="注解方式"></a>注解方式</h5><ul>
<li>恢复开发环境</li>
<li>配置事务管理器</li>
<li>开启注解事务</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;tx:annotation-driven transaction-manager=&quot;transactionManager&quot; /&gt;</div></pre></td></tr></table></figure>
<ul>
<li>在要加注解的类上加一个<code>@Transactional</code><ul>
<li>要想加属性后边加一个(),按提示写<br><img src="/uploads/Spring/03/ddffc3fc-dbe9-4068-bec8-ce9fcc328dd8.png" alt=""></li>
</ul>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/05/Spring第二阶段/" itemprop="url">
                  Spring第二阶段
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-05T21:24:30+08:00" content="2016-07-05">
              2016-07-05
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Spring/" itemprop="url" rel="index">
                    <span itemprop="name">Spring</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/05/Spring第二阶段/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/05/Spring第二阶段/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/07/05/Spring第二阶段/" class="leancloud_visitors" data-flag-title="Spring第二阶段">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h1><h2 id="Spring的Bean的管理注解开发"><a href="#Spring的Bean的管理注解开发" class="headerlink" title="Spring的Bean的管理注解开发"></a>Spring的Bean的管理注解开发</h2><p>xml：结构清晰<br>注解：开发方便(属性注入)</p>
<h3 id="Spring的IOC注解基础"><a href="#Spring的IOC注解基础" class="headerlink" title="Spring的IOC注解基础"></a>Spring的IOC注解基础</h3><ol>
<li>引包(Spring-aop的包)，Spring4.x版本需要引，低的版本不用引了，都内置了</li>
<li>引入约束，在<code>spring-framework-4.2.4.RELEASE\docs\spring-framework-reference\html\xsd-configuration.html</code> 中找到context的约束。</li>
<li>要想设置离线提示信息，则要在window中的属性设置一下，约束文件设置context的约束文件</li>
<li>开启组件扫描 <code>&lt;context:component-scan base-package=&quot;包路劲注意不要到类&quot;&gt;&lt;/component&gt;</code></li>
<li>加注解：在类上加 <code>@Component(&quot;userDao&quot;)</code></li>
<li>要想用属性，可以在实体类中添加一个私有的属性注解直接加在属性上就行<code>@Value(&quot; &quot;)</code> ，如果有set方法则需要加在set方法上。</li>
</ol>
<h3 id="Spring的IOC的注解详情"><a href="#Spring的IOC的注解详情" class="headerlink" title="Spring的IOC的注解详情"></a>Spring的IOC的注解详情</h3><ul>
<li><p>定义Bean的注解：</p>
<ul>
<li>@Component:修饰类，相当于<code>&lt;bean id=&quot;&quot;&gt;</code><ul>
<li>Spring 中提供了三个衍生注解：<ul>
<li>@Controller  : 修饰web层类的</li>
<li>@Service     : 修饰业务层类的</li>
<li>@Repository  : 修饰DAO层类的</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>属性注入的注解：</p>
<ul>
<li>@Value ：注入普通类型的值</li>
<li>@Autowired ：对象类型的属性注入，但是默认是按类型注入的，不是按名称注入<ul>
<li>要想按名称去注入，可以使用@Qulifer(value=””)的注解与@Autowired一起使用</li>
<li>还有一个Resource ：相当于@Qulifer(value=””)的注解与@Autowired一起使用的效果，此注解不是Spring包中的</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>Bean的作用范围的注解:</p>
<ul>
<li>@Scope(“ “) ：控制Bean的作用范围，默认是单例的，里面的属性跟xml里的一样。</li>
</ul>
</li>
<li><p>Bean的生命周期的注解：(在要运行的方法上)</p>
<ul>
<li>PostConstruct：初始化注解</li>
<li>PreDestory：销毁注解</li>
</ul>
</li>
</ul>
<h2 id="Spring的AOP"><a href="#Spring的AOP" class="headerlink" title="Spring的AOP"></a>Spring的AOP</h2><h3 id="什么是AOP"><a href="#什么是AOP" class="headerlink" title="什么是AOP"></a>什么是AOP</h3><p>   AOP最初是AOP联盟开发出来的，Spring用的人家的。</p>
<p>   AOP(Aspect Oriented Programming) ：面向切面编程，通过预编译方式和运行期动态代理实现程序功能的统一维护的一种技术。AOP是OOP的延续，是开发中的一个热点，也是Spring框架中的一个重要内容，是函数式编程的一种衍生范型。利用AOP可以对业务逻辑的各个部分进行隔离，从而使得业务逻辑各部分之间的耦合度降低，提高程序的可重用性，同时提高了开发的效率。</p>
<p>   AOP：<strong>面向切面编程，是OOP(面向对象编程)扩展和延伸，解决OOP中一些问题而出现。传统方式使用是纵向继承体系，AOP采用叫做横向抽取机制取代传统方式纵向继承机制对程序扩展和延伸</strong></p>
<h3 id="为什莫学习AOP"><a href="#为什莫学习AOP" class="headerlink" title="为什莫学习AOP"></a>为什莫学习AOP</h3><p>   可以不修改源代码，对程序进行扩展。<br>   主流应用：权限校验，日志记录，事务管理，性能检测。</p>
<h3 id="AOP的底层实现原理（代理机制）"><a href="#AOP的底层实现原理（代理机制）" class="headerlink" title="AOP的底层实现原理（代理机制）"></a>AOP的底层实现原理（代理机制）</h3><p>Spring底层实现AOP的原理：</p>
<ul>
<li>JDK动态代理  ：对实现了接口的类才可以产生代理</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">public class JdkProxy &#123;</div><div class="line">    </div><div class="line">    private UserDao userDao;</div><div class="line"></div><div class="line">    public JdkProxy(UserDao userDao) &#123;</div><div class="line">        this.userDao = userDao;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public UserDao createProxy()&#123;</div><div class="line">        UserDao proxy = (UserDao)Proxy.newProxyInstance(userDao.getClass().getClassLoader(), userDao.getClass().getInterfaces(), new InvocationHandler() &#123;</div><div class="line">            </div><div class="line">            @Override</div><div class="line">            public Object invoke(Object obj, Method method, Object[] args) throws Throwable &#123;</div><div class="line">                if(method.getName().equals(&quot;save&quot;))&#123;</div><div class="line">                    System.out.println(&quot;权限校验===========&quot;);</div><div class="line">                    return method.invoke(userDao, args);</div><div class="line">                &#125;</div><div class="line">                return method.invoke(userDao, args);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        return proxy;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>Cglib动态代理：对没有实现接口的类产生代理。底层字节码增强，产生子类对象。<br>使用的时候直接把Spring的包引进来就行，因为，他里边已经集合了Cglib的包</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">//这里边实现MethodInterceptor的意思是实现回掉函数，下边的intercept就相当于JDK代理中的invoke方法。所以增强方法中的setCallback中传入一个this即可</div><div class="line">public class CglibProxy implements MethodInterceptor&#123;</div><div class="line"></div><div class="line">    private ProductDao productDao;</div><div class="line"></div><div class="line">    public CglibProxy(ProductDao productDao)&#123;</div><div class="line">        this.productDao = productDao;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public ProductDao createProxy()&#123;</div><div class="line">        // 创建Cglib的产生代理核心类：</div><div class="line">        Enhancer enhancer = new Enhancer();</div><div class="line">        // 设置父类:</div><div class="line">        enhancer.setSuperclass(productDao.getClass());</div><div class="line">        // 设置回调：类似InvocationHandler</div><div class="line">        enhancer.setCallback(this);</div><div class="line">        // 产生代理：</div><div class="line">        ProductDao proxy = (ProductDao) enhancer.create();</div><div class="line">        return proxy;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public Object intercept(Object proxy, Method method, Object[] args, MethodProxy methodProxy) throws Throwable &#123;</div><div class="line"></div><div class="line">        if(method.getName().equals(&quot;save&quot;))&#123;</div><div class="line">            System.out.println(&quot;权限校验=========&quot;);</div><div class="line">            return methodProxy.invokeSuper(proxy, args);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        return methodProxy.invokeSuper(proxy, args);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="SpringAOP中的相关的术语"><a href="#SpringAOP中的相关的术语" class="headerlink" title="SpringAOP中的相关的术语"></a>SpringAOP中的相关的术语</h3><ol>
<li>JoinPoint：连接点，可以被拦截(增强)到的点。</li>
<li>Pointcut：切入点，真实被拦截到的点。</li>
<li>Advice： 通知/增强，增强的代码的实现。<ul>
<li>权限校验代码/日志记录  的这种代码称为是通知，增强</li>
</ul>
</li>
<li>Introduction：引介，增强的一种。类层面的增强。（一般不用）</li>
<li>Target：目标，被增强的类（UserDao）</li>
<li>Weaving：织入，将Advice应用到Target的过程。</li>
<li>Proxy：被增强织入以后产生的代理类</li>
<li>Aspect：切面，切面指的是多个切入点和多个通知的组合。</li>
</ol>
<h3 id="SpringAOP的入门"><a href="#SpringAOP的入门" class="headerlink" title="SpringAOP的入门"></a>SpringAOP的入门</h3><ol>
<li>引入jar包 <code>spring-aop-4.2.4.RESEASE.jar</code><ul>
<li>还有依赖包中aop的联盟的包<code>com.springsource.org.aopalliance</code></li>
<li>因为Spring用的AOP中aspectj的技术，所以还得引一个他们的依赖包：<code>com.springsource.org.aspectj.weaver</code></li>
<li>还有一个Spring整合aspectj的包（在lib中）：<code>sprin g-aspects</code></li>
</ul>
</li>
<li>编写接口跟实现类</li>
<li>创建一个Spring的配置文件，约束引入AOP的部分</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"> &lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</div><div class="line">    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</div><div class="line">    xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot; xsi:schemaLocation=&quot;</div><div class="line">        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</div><div class="line">        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd&quot;&gt;</div></pre></td></tr></table></figure>
<ol>
<li>将类配置到Spring中</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"> &lt;bean id=&quot;customerDao&quot; class=&quot;com.aop.demo3.CustomerDaoImpl&quot;&gt;</div><div class="line">&lt;/bean&gt;</div><div class="line"></div><div class="line">&lt;bean id=&quot;myAspectXml&quot; class=&quot;&quot; /&gt;</div></pre></td></tr></table></figure>
<ul>
<li>编写一个切类面</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">public class MyAspectXml&#123;</div><div class="line">    public void checkPrivilege()&#123;</div><div class="line">        syso(&quot;权限校验------&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>配置切面类</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">  //配置Spring的AOP</div><div class="line">   &lt;!-- 配置Spring的AOP --&gt;</div><div class="line">   &lt;aop:config&gt;</div><div class="line">       &lt;!-- 切入点: --&gt;</div><div class="line">       &lt;aop:pointcut expression=&quot;execution(* com.itheima.aop.demo3.CustomerDaoImpl.save(..))&quot; id=&quot;pointcut1&quot;/&gt;</div><div class="line">       &lt;!-- 配置切面 --&gt;</div><div class="line">       &lt;aop:aspect ref=&quot;myAspectXml&quot;&gt;</div><div class="line">           &lt;aop:before method=&quot;checkPrivilege&quot; pointcut-ref=&quot;pointcut1&quot;/&gt;</div><div class="line">       &lt;/aop:aspect&gt;</div><div class="line">   &lt;/aop:config&gt;</div></pre></td></tr></table></figure>
<h3 id="Spring的AOP的切入点的表达式写法"><a href="#Spring的AOP的切入点的表达式写法" class="headerlink" title="Spring的AOP的切入点的表达式写法"></a>Spring的AOP的切入点的表达式写法</h3><ul>
<li>语法：很灵活，随便写<ul>
<li>[访问修饰符] 方法的返回值 类名.方法名(参数)<ul>
<li>举例: <code>*</code> 表示任意类，任意返回值，任意方法</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">   public void com.aop.demo.CustomerDaoImpl.save(..); //save()跟save(..)效果是一样的</div><div class="line">   * *.*.demo.*DaoImpl.save(..);</div><div class="line">   * com.aop.demo.CustomerDao+.save(..); // +表示它的实现类</div><div class="line">   * com.aop.demo..*DaoImpl.save(..);   //表示任意包下的</div></pre></td></tr></table></figure>
<h3 id="Spring的AOP的通知的类型"><a href="#Spring的AOP的通知的类型" class="headerlink" title="Spring的AOP的通知的类型"></a>Spring的AOP的通知的类型</h3><ul>
<li>前置通知（before） ： 在方法执行之前进行增强，可以获得切入点的信息</li>
</ul>
<p>获得切入点的信息，传一个joinPoint对象进去<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public void before(JoinPoint joinPoint)&#123;</div><div class="line">   syso(前置通知=====joinPoint);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ul>
<li>后置通知(after-returning) ：在方法执行之后进行增强，获取方法的返回值。</li>
</ul>
<p>获得返回值：在配置文件标签上加一个<code>resulting=&quot;result名字随便起&quot;</code><br>然后再在增强的类中加一个<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public void before(Object result)&#123;</div><div class="line">   syso(后置通知=====result);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ul>
<li>环绕通知(around) ：在方法执行之前跟执行之后进行增强，阻止目标方法的执行</li>
</ul>
<p>//要想执行原有的目标方法要加一个ProceedingJoinPoint,因为增强的方法不知道是否有返回值所以一般会返回一个Object</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">public Object around(ProceedingJoinPoint joinPoint)&#123;</div><div class="line">   syso(&quot;通知前&quot;);</div><div class="line">   Object obj = joinPoint.proceed();</div><div class="line">   syso(&quot;通知后&quot;);</div><div class="line">   return obj;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>异常抛出通知(afterThrowing):在方法执行出现异常的时候进行增强，获取异常的信息。<br>异常抛出之后后面的就不执行了，因为是运行时异常</li>
</ul>
<p>可以获得异常的信息：在标签上加一个属性<code>throwing=&quot;result任意起名&quot;</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public void around(Throwable e)&#123;</div><div class="line">   syso(&quot;异常抛出通知---&quot;+e.getMessage());</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ul>
<li><p>最终通知(after)：类似try，catch中的finally。无论方法是否成功都会执行.</p>
</li>
<li><p>引介通知(不关注)</p>
</li>
</ul>
<hr>
<p>如果一个类实现了接口，则Spring用JDK代理，如果不加接口就默认用Cglib动态代理实现。当然都不能加final，都要产生子类的</p>
<h3 id="Spring与Junit的整合"><a href="#Spring与Junit的整合" class="headerlink" title="Spring与Junit的整合"></a>Spring与Junit的整合</h3><ul>
<li><p>引入test包<code>spring-test</code>(lib包中)，当然环境下有JUnit</p>
</li>
<li><p>然后再在测试类上加两个注解</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">@RunWith(SpringJUnit4ClassRunner.class)</div><div class="line">@ContextConfiguration(&quot;classpath:applicationContext.xml&quot;) //全名</div></pre></td></tr></table></figure>
</li>
<li><p>下边想用哪个类直接注入即可用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">@Resource(name=&quot;customerDao&quot;)</div><div class="line">private CustomerDao customerDao;</div></pre></td></tr></table></figure>
</li>
<li><p>然后下边的Test单元测试中直接用customerDao即可，不用再加载配置文件那么麻烦</p>
<ul>
<li>注：这里是只有是Spring跟JUnit整合的时候才能用，因为他里面已经做了一些操作，要想在别的地方使用注解的话，就必须要导包加扫描了</li>
</ul>
</li>
</ul>
<h3 id="扩展XML和注解整合开发"><a href="#扩展XML和注解整合开发" class="headerlink" title="扩展XML和注解整合开发"></a>扩展XML和注解整合开发</h3><ul>
<li>xml：管理类</li>
<li>注解：属性注入</li>
</ul>
<ol>
<li>把service跟Dao都在配置文件中实例化了</li>
<li>不要开扫描否则会出错因为扫描会扫描类上的注解文件，但是类上面没有只有属性上有，所以开启<code>&lt;context:annotation-config /&gt;</code>即可， 支持<code>@Resource，@Value,@Autowared</code>等属性上的注解</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">@Resource(name=&quot;UserDao&quot;)</div><div class="line">private UserDao userDao;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/03/Spring第一阶段/" itemprop="url">
                  Spring第一阶段
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-03T14:45:37+08:00" content="2016-07-03">
              2016-07-03
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Spring/" itemprop="url" rel="index">
                    <span itemprop="name">Spring</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/03/Spring第一阶段/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/03/Spring第一阶段/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/07/03/Spring第一阶段/" class="leancloud_visitors" data-flag-title="Spring第一阶段">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h1><h2 id="学习路线"><a href="#学习路线" class="headerlink" title="学习路线"></a>学习路线</h2><ul>
<li>Spring 的第一天：Spring 的IOC的入门，Spring整合web项目</li>
<li>Spring的第二天：IOC的注解开发，Spring的AOP的xml开发</li>
<li>Spring的第三天：Spring的Aop的注解开发，Spring的事务管理</li>
<li>ssh 的整合</li>
</ul>
<h2 id="Spring的概述"><a href="#Spring的概述" class="headerlink" title="Spring的概述"></a>Spring的概述</h2><h3 id="什么是Spring"><a href="#什么是Spring" class="headerlink" title="什么是Spring"></a>什么是Spring</h3><p>   Spring是一个开源框架，Spring是于2003年兴起的一个轻量级的Java开发框架，由Rod Johnson创建，简单来说，Spring是一个分层的javaEE/EEfull-stack（一站式） 轻量级开源框架</p>
<ul>
<li>Spring是SE/EE的<strong>一站式框架</strong>：Spring有EE开发中每一层解决的方案。</li>
<li>EE的三层结构：<ul>
<li>WEB层：Spring MVC</li>
<li>业务层：Spring的Bean管理，声明式事务</li>
<li>持久层：Spring的JDBC的模板，Spring的ORM模块</li>
</ul>
</li>
</ul>
<p>Spring的优点：</p>
<h3 id="Spring的版本"><a href="#Spring的版本" class="headerlink" title="Spring的版本"></a>Spring的版本</h3><p>Spring3.X    Spring4.X</p>
<h2 id="Spring的IOC的入门"><a href="#Spring的IOC的入门" class="headerlink" title="Spring的IOC的入门"></a>Spring的IOC的入门</h2><h3 id="IOC-Inversion-of-Control"><a href="#IOC-Inversion-of-Control" class="headerlink" title="IOC(Inversion of Control)"></a>IOC(Inversion of Control)</h3><p>IOC:控制反转，将对象的创建权反转给Spring。</p>
<ul>
<li>解决程序的耦合性</li>
</ul>
<p><img src="/uploads/Spring/01/wps8D1.tmp.jpg" alt=""></p>
<h3 id="Spring的入门"><a href="#Spring的入门" class="headerlink" title="Spring的入门"></a>Spring的入门</h3><ul>
<li>第一步：下载Spring的开发包<ul>
<li>官网： <a href="http://spring.io" target="_blank" rel="external">spring</a> 下载<code>spring-framework-4.2.4.RELEASE-dist.zip</code></li>
<li>解压：Spring的开发包<ul>
<li>docs</li>
<li>libs</li>
<li>schema</li>
</ul>
</li>
</ul>
</li>
<li>第二：导包:只需要导红色圈里的那几个就行，还有log4j的一个包，跟一个日志的接口包commons-logging</li>
</ul>
<p><img src="/uploads/Spring/01/wpsFBDC.tmp.jpg" alt=""></p>
<ul>
<li>第三：编写接口跟实现类</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">public interface UserDao &#123;</div><div class="line">   public void sayHello();</div><div class="line">&#125;</div><div class="line">public class UserDaoImpl implements UserDao &#123;</div><div class="line">   @Override</div><div class="line">   public void sayHello() &#123;</div><div class="line">        System.out.println(&quot;Hello Spring Demo1...&quot;);</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>第四：创建一个Spring的核心配置文件：<ul>
<li>在src下创建 <code>applicationContext.xml</code> 名字可以变</li>
<li>引入约束</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">//约束在spring-framework-4.2.4.RELEASE\docs\spring-framework-reference\html\xsd-configuration.html</div><div class="line">&lt;beans</div><div class="line">    xmlns=&quot;http://www.springframework.org/schema/beans&quot;</div><div class="line">    xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</div><div class="line">    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</div><div class="line">    xsi:schemaLocation=&quot;</div><div class="line">        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt;</div><div class="line"></div><div class="line">.............................</div><div class="line"></div><div class="line"></div><div class="line">&lt;/beans&gt;</div></pre></td></tr></table></figure>
<ul>
<li>编写Spring配置文件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;bean id=&quot;userDao&quot; class=&quot;路径&quot;&gt;&lt;/bean&gt;</div></pre></td></tr></table></figure>
<ul>
<li>第五：编写测试类<br>//Spring的方式：IOC的底层实现：工厂+反射+配置文件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">public void demo2()&#123;</div><div class="line">  ApplicationContext addli= new ClassPathXmlApplicationContext(&quot;applicationContext.xml&quot;);</div><div class="line">  UserDao userDao=(UserDao) appli.getBean(&quot;userDao&quot;);;</div><div class="line">  userDao.sayHello();</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="DI"><a href="#DI" class="headerlink" title="DI"></a>DI</h3><blockquote>
<p>DI:依赖注入。需要有IOC的环境</p>
</blockquote>
<ul>
<li>IOC和DI的区别：<ul>
<li>IOC：控制反转：将对象的创建权交给Spring</li>
<li>DI:Spring在创建过程中，将类依赖的属性注入进来</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">//现在要配置的类中创建属性,并提供set方法</div><div class="line">//然后再在配置文件中配置</div><div class="line">&lt;bean id=&quot;UserDao&quot; class=&quot;UserDao路劲&quot;&gt;</div><div class="line">    //注入属性</div><div class="line">    &lt;property name=&quot;name&quot; value=&quot;李四&quot;/&gt;</div><div class="line">&lt;/bean&gt;</div></pre></td></tr></table></figure>
<h3 id="Spring的工厂类的概述"><a href="#Spring的工厂类的概述" class="headerlink" title="Spring的工厂类的概述"></a>Spring的工厂类的概述</h3><h4 id="BeanFactory"><a href="#BeanFactory" class="headerlink" title="BeanFactory"></a>BeanFactory</h4><ul>
<li><code>BeanFactory</code>是Spring 早期的工厂类，现在已经不用了</li>
<li>BeanFactory在调用<code>getBean()</code>的时候才会创建类的实例。</li>
</ul>
<h4 id="ApplicationContext"><a href="#ApplicationContext" class="headerlink" title="ApplicationContext"></a><strong>ApplicationContext</strong></h4><ul>
<li>ApplicationContext是Spring目前使用的工厂类</li>
<li>ApplicationContext支持比BeanFactory更加强大的功能(国际化)</li>
<li><p>ApplicationContext在加载Spring的配置文件的时候，就会创建类的实例</p>
</li>
<li><p>在<code>ApplicationContext</code>下有两个实例：</p>
<ul>
<li><code>ClassPathXmlApplicationContext</code>：<strong>加载类路劲下的配置文件</strong></li>
<li><code>FileSystemXmlAppliocationContext</code> ：加载本地硬盘上的配置文件</li>
</ul>
</li>
</ul>
<h3 id="Spring的常见的配置"><a href="#Spring的常见的配置" class="headerlink" title="Spring的常见的配置"></a>Spring的常见的配置</h3><p><code>&lt;bean id=&quot;&quot; class=&quot;&quot; scope=&quot;&quot; init-method=&quot;方法名&quot; destory-method=&quot;方法名&quot; /&gt;</code></p>
<ul>
<li>后边的两个可以省略</li>
</ul>
<h4 id="Id和name的配置"><a href="#Id和name的配置" class="headerlink" title="Id和name的配置"></a>Id和name的配置</h4><ul>
<li>id:用到了唯一的约束，都不要使用相同名称的值。<strong>Id中不能使用特殊字符</strong></li>
<li>name:没有使用唯一的约束，都不要使用相同名称的值。name中可以使用特殊字符。<ul>
<li>id跟name中如果有相同的值，运行时会报错。</li>
</ul>
</li>
</ul>
<p>在Struts1框架中，Action交给Spring管理<br><code>&lt;bean name=&quot;/login&quot; class=&quot;xxx&quot;&gt;</code> 因为有<code>/</code>所以只能用name。</p>
<h4 id="scope的配置：Bean作用范围"><a href="#scope的配置：Bean作用范围" class="headerlink" title="scope的配置：Bean作用范围"></a>scope的配置：Bean作用范围</h4><ul>
<li><strong>singleton</strong> :默认值，单例的，在一个方法中不管创建多少次，都是同一个对象。</li>
<li><strong>prototype</strong> ：多例的。</li>
<li>request   ：在Web项目中使用，创建一个类，保存到request域中。</li>
<li>session   ：在web项目中使用，创建一个类，保存到session中。</li>
<li>globalsession：在web项目中使用，而且<code>Prolet</code>环境，就是例如登陆了百度，就能访问百度云啊贴吧啊什么的。</li>
</ul>
<h4 id="bean的生命周期的配置-可以省略"><a href="#bean的生命周期的配置-可以省略" class="headerlink" title="bean的生命周期的配置(可以省略)"></a>bean的生命周期的配置(可以省略)</h4><p>初始化方法跟销毁方法都是要在UserDao类中定义的。</p>
<ul>
<li>init-method=”方法名”    ：Bean被创建的时候要去执行的方法</li>
<li>destory-method=”方法名” ：Bean被销毁的时候要去执行的方法<ul>
<li>Bean 的创建必须是单例的，而且必须是关闭工厂<code>ClassPathXmlApplicationContext对象.close()</code></li>
</ul>
</li>
</ul>
<h3 id="配置不联网提示"><a href="#配置不联网提示" class="headerlink" title="配置不联网提示"></a>配置不联网提示</h3><ul>
<li>windows属性 —&gt; xml catalog —&gt; 约束中的最后一个地址复制过来到<code>key</code>,上面选择本地中的<code>spring-framework-4.2.4.RELEASE\schema\beans\4.2</code>的那个，中间选择<code>key type</code>为<code>Schema location</code></li>
</ul>
<h2 id="Spring的Bean管理的xml的方式"><a href="#Spring的Bean管理的xml的方式" class="headerlink" title="Spring的Bean管理的xml的方式"></a>Spring的Bean管理的xml的方式</h2><h3 id="Spring的Bean的创建"><a href="#Spring的Bean的创建" class="headerlink" title="Spring的Bean的创建"></a>Spring的Bean的创建</h3><p>Spring中提供了三种Bean的实例化的方式：</p>
<ul>
<li>无参构造的方式</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">//bean类</div><div class="line">public class bean&#123;</div><div class="line">   public bean()&#123;</div><div class="line">      syso(&quot;无参构造被调用&quot;);</div><div class="line">   &#125;</div><div class="line">&#125;</div><div class="line">//配置文件</div><div class="line">&lt;bean id=&quot;bean&quot; class=&quot;bean的地址&quot;&gt;</div></pre></td></tr></table></figure>
<ul>
<li>静态工厂实例化的方式</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">//bean类</div><div class="line">public class bean&#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line">//静态工厂类</div><div class="line">public class beanFactory&#123;</div><div class="line">   public static Bean createBean()&#123;</div><div class="line">      syso(&quot;静态工厂执行了&quot;);</div><div class="line">      return new Bean();</div><div class="line">   &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">//配置文件</div><div class="line">&lt;bean id=&quot;bean&quot; class=&quot;beanFactory的地址&quot; factory-method=&quot;createBean&quot;&gt;</div></pre></td></tr></table></figure>
<ul>
<li>实例工厂实例化的方式</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">//bean类</div><div class="line">public class bean&#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line">//实例工厂类</div><div class="line">public class beanFactory&#123;</div><div class="line">   public Bean createBean()&#123;</div><div class="line">      syso(&quot;实例工厂执行了&quot;);</div><div class="line">      return new Bean();</div><div class="line">   &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">//配置文件</div><div class="line">&lt;bean id=&quot;beanFactory&quot; class=&quot;beanFactory的地址&quot; /&gt;</div><div class="line">&lt;bean id=&quot;bean&quot; factory-bean=&quot;beanFactory&quot; factory-method=&quot;createBean&quot; /&gt;</div></pre></td></tr></table></figure>
<h3 id="Bean的属性注入"><a href="#Bean的属性注入" class="headerlink" title="Bean的属性注入"></a>Bean的属性注入</h3><h4 id="Bean的属性注入-1"><a href="#Bean的属性注入-1" class="headerlink" title="Bean的属性注入"></a>Bean的属性注入</h4><ul>
<li><ol>
<li>构造方法的方式</li>
</ol>
</li>
<li><ol>
<li>set方法的属性注入</li>
</ol>
</li>
<li><ol>
<li>接口注入的方式</li>
</ol>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">public interface Injection&#123;</div><div class="line">   public void setUsername(String username);</div><div class="line">&#125;</div><div class="line"></div><div class="line">class User implements Injection&#123;</div><div class="line">  private String username;</div><div class="line">  public void setUsername(String username)&#123;</div><div class="line">     this.username=username;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Spring的Bean的属性注入"><a href="#Spring的Bean的属性注入" class="headerlink" title="Spring的Bean的属性注入"></a>Spring的Bean的属性注入</h4><p>Spring 中只支持前两种:</p>
<ul>
<li>构造函数：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">//配置文件,当然前提是有这个实体类跟有参构造函数</div><div class="line">&lt;bean id=&quot;car&quot; class=&quot;car的路劲&quot; &gt;</div><div class="line">   &lt;constructor-arg name=&quot;&quot; value=&quot;&quot; /&gt;</div><div class="line">   &lt;constructor-arg name=&quot;&quot; value=&quot;&quot; /&gt;</div><div class="line">&lt;/bean&gt;</div><div class="line">//构造注入中的&lt;constructor-args name=&quot;&quot;&gt;</div><div class="line">name也可以换为index，从0开始表示第一个构造方法中的值是什么</div></pre></td></tr></table></figure>
<ul>
<li>set方法</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">//配置文件,当然前提是有这个实体类跟set方法</div><div class="line">&lt;bean id=&quot;car2&quot; class=&quot;com.itheima.spring.demo4.Car2&quot;&gt;</div><div class="line">   &lt;property name=&quot;name&quot; value=&quot;宝马/&gt;</div><div class="line">   &lt;property name=&quot;price&quot; value=&quot;800000&quot;/&gt;</div><div class="line">&lt;/bean&gt;</div></pre></td></tr></table></figure>
<ul>
<li>set中如果有对象的话</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;bean id=&quot;people&quot; class=&quot;people的路劲&quot; &gt;</div><div class="line">   &lt;constructor-arg name=&quot;正常的属性名&quot; value=&quot;正常的属性值&quot; /&gt;</div><div class="line">   &lt;constructor-arg name=&quot;正常的属性名&quot; ref=&quot;前面配置文件的id这里用car&quot; /&gt;</div><div class="line">&lt;/bean&gt;</div></pre></td></tr></table></figure>
<h5 id="Spring2-5版本之后提供p名称空间的属性注入"><a href="#Spring2-5版本之后提供p名称空间的属性注入" class="headerlink" title="Spring2.5版本之后提供p名称空间的属性注入"></a>Spring2.5版本之后提供p名称空间的属性注入</h5><ul>
<li>引入p名称空间：<code>xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</code></li>
<li>完成属性注入：<ul>
<li>格式：<ul>
<li>普通属性       p:属性名=“属性值”</li>
<li>对象类型的属性  p:属性名-ref=“其他属性的id或name”</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">//普通</div><div class="line">&lt;bean id=&quot;car&quot; class=&quot;car路劲&quot; p:name=&quot;&quot; p:price=&quot;&quot; /&gt;</div><div class="line"></div><div class="line">//对象类型的</div><div class="line">&lt;bean id=&quot;people&quot; class=&quot;people的路劲&quot; p:name=&quot;&quot; p:car-ref=&quot;car&quot; /&gt;</div></pre></td></tr></table></figure>
<h5 id="Spring3-X版本之后提供的-spEL-的属性注入："><a href="#Spring3-X版本之后提供的-spEL-的属性注入：" class="headerlink" title="Spring3.X版本之后提供的 spEL 的属性注入："></a>Spring3.X版本之后提供的 spEL 的属性注入：</h5><ul>
<li>spEL：Spring Expression Language<ul>
<li>/#{}</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">//普通类型</div><div class="line">&lt;bean id=&quot;car&quot; class=&quot;&quot;&gt;</div><div class="line">   &lt;property name=&quot;name&quot; value=&quot;#&#123;&apos;奔驰&apos;&#125;&quot;&gt;</div><div class="line">   &lt;property name=&quot;price&quot; value=&quot;#&#123;123&#125;&quot;&gt;</div><div class="line">&lt;/bean&gt;</div><div class="line"></div><div class="line">//对象类型</div><div class="line">&lt;bean id=&quot;employee&quot; class=&quot;&quot;&gt;</div><div class="line">   &lt;property name=&quot;name&quot; value=&quot;#&#123;&apos;强强&apos;&#125;&quot;&gt;</div><div class="line">   &lt;property name=&quot;car&quot; value=&quot;#&#123;car&#125;&quot;&gt;</div><div class="line">&lt;/bean&gt;</div></pre></td></tr></table></figure>
<ul>
<li>还能用另外一个类的属性或方法名来赋值，先创建这个类，要用属性的话，可以直接写get方法，不用定义成员变量的。<ul>
<li>要想用哪个类中的方法，就得先实例化这个类</li>
<li>然后再 #{实例化类名.属性/方法} 就可以了</li>
</ul>
</li>
</ul>
<p>//定义要使用的类<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">public class CarInfo &#123;</div><div class="line">    //public String name;</div><div class="line">    public String getName() &#123;</div><div class="line">        return &quot;奔驰&quot;;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    public Double calculatePrice()&#123;</div><div class="line">        return Math.PI * 100000;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h5 id="复杂类型的属性注入"><a href="#复杂类型的属性注入" class="headerlink" title="复杂类型的属性注入"></a>复杂类型的属性注入</h5><p>list map propertise 等复杂的属性类型</p>
<ul>
<li>list/数组</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">//如果list的是对象最里边可以用&lt;ref/&gt;</div><div class="line">&lt;bean id=&quot;&quot; class=&quot;&quot; &gt;</div><div class="line">   &lt;property name=&quot;lists&quot;&gt;</div><div class="line">      &lt;list&gt;</div><div class="line">        &lt;value&gt;值&lt;/value&gt;</div><div class="line">        &lt;value&gt;值&lt;/value&gt;</div><div class="line">        &lt;value&gt;值&lt;/value&gt;</div><div class="line">      &lt;list&gt;</div><div class="line">   &lt;/property&gt;</div><div class="line">&lt;/bean&gt;</div></pre></td></tr></table></figure>
<ul>
<li>map</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">//如果map里边是对象&lt;entry key-ref=&quot;&quot; value-ref=&quot;&quot;/&gt;</div><div class="line">&lt;bean id=&quot;&quot; class=&quot;&quot; &gt;</div><div class="line">   &lt;property name=&quot;maps&quot;&gt;</div><div class="line">      &lt;map&gt;</div><div class="line">        &lt;entry key=&quot;&quot; value=&quot;&quot; /&gt;</div><div class="line">      &lt;map&gt;</div><div class="line">   &lt;/property&gt;</div><div class="line">&lt;/bean&gt;</div></pre></td></tr></table></figure>
<p>map还有一种方式<br>  需要生成set方法，并在map标签中添加 <code>&lt;entry&gt; &lt;key&gt; &lt;value&gt;test1&lt;/value&gt; &lt;/key&gt; &lt;value&gt;AAA&lt;/value&gt; &lt;/entry&gt;</code></p>
<ul>
<li>propertise,键值对的形式</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;bean id=&quot;&quot; class=&quot;&quot; &gt;</div><div class="line">   &lt;property name=&quot;props&quot;&gt;</div><div class="line">      &lt;props&gt;</div><div class="line">        &lt;props key=&quot;&quot;&gt;值&lt;/props&gt;</div><div class="line">      &lt;props&gt;</div><div class="line">   &lt;/property&gt;</div><div class="line">&lt;/bean&gt;</div></pre></td></tr></table></figure>
<h3 id="Spring的分模块开发"><a href="#Spring的分模块开发" class="headerlink" title="Spring的分模块开发"></a>Spring的分模块开发</h3><p>就是可能有两个配置文件，分别配置不同的类</p>
<ul>
<li>可以在加载配置文件时加载两个配置文件，用 <code>，</code> 隔开</li>
<li>也可以只加载一个配置文件，然后在其中引入另外一个配置文件<ul>
<li><code>&lt;import resource=&quot;applicationContext2.xml&quot;&gt;</code><ul>
<li>如果引入的配置文件中的id有跟原配置文件的id相同的值，则会覆盖原来的。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="案例中出现的问题"><a href="#案例中出现的问题" class="headerlink" title="案例中出现的问题"></a>案例中出现的问题</h2><h3 id="将Dao配置到Spring"><a href="#将Dao配置到Spring" class="headerlink" title="将Dao配置到Spring"></a>将Dao配置到Spring</h3><ul>
<li>可以在配置service方法的时候把，Dao当作一个属性来配置，先把customerDao实例化，然后再引入到service配置文件中：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;bean id=&quot;customerService&quot; class=&quot;com.itheima.crm.service.impl.CustomerServiceImpl&quot;&gt;</div><div class="line">    &lt;property name=&quot;customerDao&quot; ref=&quot;customerDao&quot;/&gt;</div><div class="line">&lt;/bean&gt;</div><div class="line"></div><div class="line">&lt;bean id=&quot;customerDao&quot; class=&quot;com.itheima.crm.dao.impl.CustomerDaoImpl&quot;&gt;</div><div class="line">&lt;/bean&gt;</div></pre></td></tr></table></figure>
<h3 id="配置监听器，使每次获取的都是同一个工厂类"><a href="#配置监听器，使每次获取的都是同一个工厂类" class="headerlink" title="配置监听器，使每次获取的都是同一个工厂类"></a>配置监听器，使每次获取的都是同一个工厂类</h3><ul>
<li>为了避免每次用的时候，都创建一个工厂类，用监听器，在服务器启动的时候就让创建了工厂了，并存在ServletContext中，以后直接用就行<ul>
<li>先引一个Spring的jar包：<code>spring-web-4.2.4.RELEASE.jar</code></li>
<li>包中已经配好了监听器，直接配置就行：</li>
</ul>
</li>
</ul>
<p>在web下配置监听器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"> &lt;listener&gt;</div><div class="line">    &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;</div><div class="line">  &lt;/listener&gt;</div><div class="line"></div><div class="line">//让上面那个监听器去加载下边的这个配置文件</div><div class="line">&lt;context-param&gt;</div><div class="line">    &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;</div><div class="line">    &lt;param-value&gt;classpath:applicationContext.xml&lt;/param-value&gt;</div><div class="line">&lt;/context-param&gt;</div></pre></td></tr></table></figure>
<p>获得工厂：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">//保存客户的方法:save</div><div class="line">public String save()&#123;</div><div class="line">   //调用业务层，使用包中封装好的工具类获得servletContext中的工厂类</div><div class="line">   WebApplicationContext applicationContext = WebApplicationContextUtils.getWebApplicationContext(ServletActionContext.getServletContext_());</div><div class="line"></div><div class="line">   CustomerService customerService = (CustomerService)   applicationContext.getBean(&quot;customerService&quot;);</div><div class="line">   customerService.save(customer);</div><div class="line">   return NONE;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/25/Struts04/" itemprop="url">
                  Struts第四阶段
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-25T13:52:49+08:00" content="2016-06-25">
              2016-06-25
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/struts2/" itemprop="url" rel="index">
                    <span itemprop="name">struts2</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/25/Struts04/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/25/Struts04/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/06/25/Struts04/" class="leancloud_visitors" data-flag-title="Struts第四阶段">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Struts2"><a href="#Struts2" class="headerlink" title="Struts2"></a>Struts2</h1><h2 id="拦截器的概述"><a href="#拦截器的概述" class="headerlink" title="拦截器的概述"></a>拦截器的概述</h2><h3 id="什么是拦截器"><a href="#什么是拦截器" class="headerlink" title="什么是拦截器"></a>什么是拦截器</h3><p>   拦截器是Struts2中的核心。其实就是一个类对Action的访问进行拦截。</p>
<h4 id="拦截器与过滤器的区别："><a href="#拦截器与过滤器的区别：" class="headerlink" title="拦截器与过滤器的区别："></a>拦截器与过滤器的区别：</h4><ul>
<li>过滤器过滤的是从客户端向服务器发送的请求。过滤器是可以过滤Html, JSP…</li>
<li>拦截器拦截的是从客户端向Action发送的请求。拦截器只能拦截Action，拦截器更细粒度的实施拦截。拦截到Action中具体的方法。</li>
</ul>
<h3 id="Struts2的执行流程："><a href="#Struts2的执行流程：" class="headerlink" title="Struts2的执行流程："></a>Struts2的执行流程：</h3><ul>
<li>请求访问Action，请求首先到达核心过滤器，过滤器会调用Dispather中的ServiceAction的方法</li>
<li>在这个方法内部，Struts2框架创建一个Action代理对象，执行代理对象中的execute方法，在execute内部方法调用Actioninvocatin中的invoke方法。</li>
<li>在invoke方法内部，递归调用拦截器的拦截的方法，如果没有下一个拦截器，执行目标Actioin，根据Action返回Result进行页面跳转，由Response做出响应。</li>
</ul>
<p><img src="/uploads/Struts2/04/a49529f6-6bee-4816-877b-6fe20e1ea9a6.jpg" alt=""></p>
<h3 id="自定义拦截器"><a href="#自定义拦截器" class="headerlink" title="自定义拦截器"></a>自定义拦截器</h3><ol>
<li>实现Interceptor接口或者继承AbstractInterceptor类</li>
<li>配置拦截器</li>
</ol>
<p>编写：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">public class InterceptorDemo1 extends AbstractInterceptor&#123;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public String intercept(ActionInvocation invocation) throws Exception &#123;</div><div class="line">        System.out.println(&quot;InterceptorDemo1执行了...&quot;);</div><div class="line">        </div><div class="line">        String s = invocation.invoke();</div><div class="line">        </div><div class="line">        System.out.println(&quot;InterceptorDemo1执行结束了...&quot;);</div><div class="line">        </div><div class="line">        return s;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>配置拦截器</p>
<ul>
<li>配置的时候会有顺序，默认的在前面，就先执行默认的，自己定义的在前面就先执行自己的</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">//在&lt;package&gt;标签中配置</div><div class="line">&lt;interceptors&gt;</div><div class="line">   &lt;interceptor name=&quot;名字&quot; class=&quot;拦截器路劲&quot; &gt;&lt;/interceptor&gt;</div><div class="line">&lt;/interceptors&gt;</div><div class="line"></div><div class="line">//**因为自定义之后默认的拦截器就不引用了，所以得引用一下默认的拦截器**</div><div class="line">&lt;interceptor-ref name=&quot;defaultStack&quot;&gt;</div><div class="line">//然后再&lt;action&gt; 标签中引用一下</div><div class="line">&lt;interceptor-ref name=&quot;拦截器名字&quot; /&gt;</div></pre></td></tr></table></figure>
<p>2.还可以定义一个拦截器栈，在一块引用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;interceptors&gt;</div><div class="line">   &lt;interceptor name=&quot;interceptor01&quot; class=&quot;路劲&quot; /&gt;</div><div class="line">   &lt;interceptor name=&quot;interceptor02&quot; class=&quot;路劲&quot; /&gt;</div><div class="line">   &lt;interceptor-stack name=&quot;myStack&quot;&gt;</div><div class="line">      &lt;interceptor-ref name=&quot;defaultStack&quot;/&gt;</div><div class="line">      &lt;interceptor-ref name=&quot;interceptor01&quot;/&gt;</div><div class="line">      &lt;interceptor-ref name=&quot;interceptor02&quot;/&gt;</div><div class="line">   &lt;/interceptor-stack&gt;</div><div class="line">&lt;/interceptors&gt;</div><div class="line"></div><div class="line">//引用的时候只需要引用拦截器栈就可以了</div><div class="line">&lt;interceptor-ref name=&quot;myStack&quot;/&gt;</div></pre></td></tr></table></figure>
<h2 id="案例：登陆页面"><a href="#案例：登陆页面" class="headerlink" title="案例：登陆页面"></a>案例：登陆页面</h2><h3 id="错误信息"><a href="#错误信息" class="headerlink" title="错误信息"></a>错误信息</h3><p>回显错误信息：转发到登陆页面，否则actionerror用不了<br>这里用到了<code>actionerror</code></p>
<ul>
<li>把错误信息存到值栈中 <code>this.addactionError(&quot;错误信息&quot;);</code></li>
<li>在jsp中回显错误信息 <code>&lt;s:actionerror/&gt;</code></li>
</ul>
<h3 id="登陆权限"><a href="#登陆权限" class="headerlink" title="登陆权限"></a>登陆权限</h3><ul>
<li>编写拦截器</li>
</ul>
<p>注：拦截一个方法用的是<code>MethodFilterInterceptor</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">public class PrivilegeInterceptor extends MethodFilterInterceptor&#123;</div><div class="line"></div><div class="line">   @override</div><div class="line">   protected String doIntercept(ActionInvocation invocation)&#123;</div><div class="line">      //获得已存在的用户信息</div><div class="line">      User existUser = (User) ServletActionContext.getRequest().getSession().getAttribute(&quot;existUser&quot;);</div><div class="line">      if(exiteUser!=null)&#123;</div><div class="line">         return invocation.invoke();</div><div class="line">      &#125;else&#123;</div><div class="line">         ActionSupport actionSupport=(ActionSupport)invocation.getAction();</div><div class="line">         actionSupport.addActionError(&quot;您还没有登陆！您还没有访问权限！&quot;);</div><div class="line">         return actionSupport.LOGIN;</div><div class="line">      &#125;</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>配置拦截器</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">//配置拦截器</div><div class="line">&lt;interceptors&gt;</div><div class="line">  &lt;interceptor name=&quot;PrivilegeInterceptor&quot; class=&quot;。。。 &quot;/&gt;</div><div class="line">&lt;interceptors&gt;</div><div class="line"></div><div class="line">//在`action`中引用拦截器</div><div class="line">&lt;interceptor-ref name=&quot;PrivilegeInterceptor&quot;&gt;</div><div class="line">   //因为在登陆的页面就不需要拦截了，所以可以加一个`param`来避免要拦截的页面</div><div class="line">   &lt;param name=&quot;excludeMethods&quot;&gt;登陆时的方法名&lt;/param&gt;</div><div class="line">&lt;/interceptor-ref&gt;</div></pre></td></tr></table></figure>
<ul>
<li><p>还得配一个全局的login，就拦截的信息转到login，dtd规定全局配置必须在拦截器下边</p>
</li>
<li><p>还有万一拦截之后发生错误，转到登陆页面，在登陆成功会发生嵌套效果，避免这种效果的方法是，在登陆的<code>form</code>标签上加一个<code>target=&quot;_parent&quot;</code></p>
</li>
</ul>
<h2 id="struts2的标签库"><a href="#struts2的标签库" class="headerlink" title="struts2的标签库"></a>struts2的标签库</h2><h3 id="通用的标签库Generi-Tags"><a href="#通用的标签库Generi-Tags" class="headerlink" title="通用的标签库Generi Tags"></a>通用的标签库Generi Tags</h3><ul>
<li><p>帮助文档中的<code>Tag reference</code><br><img src="/uploads/Struts2/04/b40ea8f8-6502-4901-b5b6-1c1545497ec7.jpg" alt=""></p>
</li>
<li><p>传参数：<code>&lt;s:param name=&quot;&quot; value=&quot;&quot;/&gt;</code></p>
</li>
</ul>
<hr>
<ul>
<li>在遍历List集合的时候，放var里取出来时，可以加<code>#</code>,也可以不加，因为，他会在<code>context</code>中也放一个</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;s:iterator value=&quot;&#123;&apos;a&apos;,&apos;b&apos;,&apos;c&apos;&#125;&quot; var=&quot;i&quot;&gt;</div><div class="line">    &lt;s:property value=&quot;i&quot;/&gt;---&lt;s:property value=&quot;#i&quot;/&gt;</div><div class="line">&lt;/s:iterator&gt;</div></pre></td></tr></table></figure>
<ul>
<li>遍历一些数，把其中3的倍数变红，每次加10</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;h2&gt;遍历&lt;/h2&gt;</div><div class="line">&lt;s:iterator begin=&quot;10&quot; end=&quot;300&quot; step=&quot;10&quot; var=&quot;i&quot; status=&quot;sta&quot;&gt;</div><div class="line">    &lt;s:if test=&quot;#sta.count % 3 == 0&quot;&gt;</div><div class="line">        &lt;font color=&quot;red&quot;&gt;&lt;s:property value=&quot;i&quot;/&gt;&lt;/font&gt;</div><div class="line">    &lt;/s:if&gt;</div><div class="line">    &lt;s:else&gt;</div><div class="line">        &lt;s:property value=&quot;i&quot;/&gt;</div><div class="line">    &lt;/s:else&gt;</div><div class="line">&lt;/s:iterator&gt;</div></pre></td></tr></table></figure>
<h3 id="UI标签库-UI-Tags"><a href="#UI标签库-UI-Tags" class="headerlink" title="UI标签库 UI Tags"></a>UI标签库 UI Tags</h3><ul>
<li>优势：点文字可以获得焦点，文本框会加一些基本的样式，例如换行啊。。。</li>
</ul>
<p><img src="/uploads/Struts2/04/d82cc1ee-377b-4977-a377-eae2b6da9804.jpg" alt=""></p>
<ul>
<li>会提供一套默认的样式样式 <code>xhtml</code><ul>
<li>可以不用，在表单上加一个<code>theme=&quot;simple&quot;</code>,或者在常量上改变，这样所有的就都不能用了</li>
</ul>
</li>
</ul>
<h4 id="UI标签的数据回显："><a href="#UI标签的数据回显：" class="headerlink" title="UI标签的数据回显："></a>UI标签的数据回显：</h4><p>优点：</p>
<ul>
<li>将查询到的数据显示到指定文本框</li>
<li>数据校验或类型转换出错情况下</li>
</ul>
<p>数据除了密码都会回显，并且会显示错误信息，密码也要回显添加一个<code>showpassword=true</code></p>
<p>是在root区存着的。</p>
<h2 id="Struts2的注解开发"><a href="#Struts2的注解开发" class="headerlink" title="Struts2的注解开发"></a>Struts2的注解开发</h2><ol>
<li>引包 <code>struts-convention-plugin</code></li>
<li>写好action之后加<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">@ParentPackage(&quot;struts-default&quot;)</div><div class="line">@Namespace(&quot;/&quot;)</div><div class="line">public class HelloAction extends ActionSupport&#123;</div><div class="line">     @Action(value=&quot;访问路劲相当于action中的name&quot;，results=&quot;返回值&quot;)</div><div class="line">     public String execute()&#123;</div><div class="line">        syso();</div><div class="line">        return ...;</div><div class="line">     &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/17/Struts03/" itemprop="url">
                  Struts第三阶段
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-17T20:24:45+08:00" content="2016-06-17">
              2016-06-17
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/struts2/" itemprop="url" rel="index">
                    <span itemprop="name">struts2</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/17/Struts03/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/17/Struts03/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/06/17/Struts03/" class="leancloud_visitors" data-flag-title="Struts第三阶段">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Struts2"><a href="#Struts2" class="headerlink" title="Struts2"></a>Struts2</h1><h2 id="OGNL的概述"><a href="#OGNL的概述" class="headerlink" title="OGNL的概述"></a>OGNL的概述</h2><ul>
<li><p>OGNL(Object Graph Navigation Language):对象图导航语言<br>是一个独立的表达式语言，Struts2感觉OGNL很强大，将OGNL引入到自身</p>
</li>
<li><p>OGNL比EL强大很多倍的表达式的语言。（EL获取的数据来源与四个作用域，EL提供11个Web对象）</p>
</li>
</ul>
<blockquote>
<p>作用：</p>
</blockquote>
<p><img src="/uploads/Struts2/03/8c96fc0a-1938-47a8-9f42-476310501bee.jpg" alt=""></p>
<h3 id="OGNL的要素"><a href="#OGNL的要素" class="headerlink" title="OGNL的要素"></a>OGNL的要素</h3><p>context（OgnlContext），root(CompoundRoot)，表达式</p>
<h3 id="OGNL在java中的使用-了解）"><a href="#OGNL在java中的使用-了解）" class="headerlink" title="OGNL在java中的使用(了解）"></a>OGNL在java中的使用(了解）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">//获取对象的方法</div><div class="line">@Test</div><div class="line">public void demo01()&#123;</div><div class="line">    //获得数据</div><div class="line">    OgnlContext context=new OgnlContext();</div><div class="line">    Object obj = Ognl.getValue(&quot;&apos;helloworld&apos;.length()&quot;,context,context.getRoot());</div><div class="line">    System.out.println(obj);</div><div class="line">&#125;</div><div class="line"></div><div class="line">//获取静态对象的方法</div><div class="line">@Test</div><div class="line">public void demo02()&#123;</div><div class="line">    //获得数据</div><div class="line">    OgnlContext context=new OgnlContext();</div><div class="line">    Object obj = Ognl.getValue(&quot;@java.lang.Math@random()&quot;,context,context.getRoot());</div><div class="line">    System.out.println(obj); //打印一个1以内的小数</div><div class="line">&#125;</div><div class="line"></div><div class="line">//获取root中的数据</div><div class="line">@Test</div><div class="line">public void demo03()&#123;</div><div class="line"></div><div class="line">    Product product = new Product();</div><div class="line">    product.setName(&quot;john&quot;);</div><div class="line">    </div><div class="line">    //获得数据</div><div class="line">    OgnlContext context=new OgnlContext();</div><div class="line">    context.setRoot(product);</div><div class="line">    </div><div class="line">    Object obj = Ognl.getValue(&quot;name&quot;,context,context.getRoot());</div><div class="line">    System.out.println(obj);</div><div class="line">&#125;</div><div class="line"></div><div class="line">//OGNL获取context的数据</div><div class="line">//context中存入的List集合，其他的普通的值</div><div class="line">//获取context数据需加#</div><div class="line">@Test</div><div class="line">public void demo03()&#123;</div><div class="line">    //获得context</div><div class="line">    OgnlContext context=new OgnlContext();</div><div class="line">    context.put(&quot;key&quot;,&quot;阿斯顿&quot;);</div><div class="line">    Object obj =Ognl.getValue(&quot;#key&quot;,context,context.getRoot());</div><div class="line">    System.out.println(obj);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="值栈"><a href="#值栈" class="headerlink" title="值栈"></a>值栈</h2><h3 id="什么是值栈"><a href="#什么是值栈" class="headerlink" title="什么是值栈"></a>什么是值栈</h3><p>   ValueStack：相当于Struts2的数据的中转站，<strong>ValueStack贯穿了整个action的生命周期。</strong><br>   Action是多例的，一次请求服务器请求就会创建一个Action，同时会为这个Action创建一个ValueStack对象。Struts2通过OGNL表达式获取值栈的数据。<br>   ValueStack是Struck2的一个接口，OGNLValueStack是该接口的实现类。</p>
<h3 id="值栈的内部结构"><a href="#值栈的内部结构" class="headerlink" title="值栈的内部结构"></a>值栈的内部结构</h3><ul>
<li>值栈分为root区跟context区，root(CompoundRoot)区是一个list集合，context(OgnlContext)是一个map<ul>
<li>操作值栈一般是操作root</li>
<li>context中存入了root，还有session等多个域</li>
</ul>
</li>
</ul>
<p><img src="/uploads/Struts2/03/b6e18ac2-dc51-4e76-bc13-28c89aa56db5.png" alt=""></p>
<p>查看值栈的内部结构：</p>
<ol>
<li><p>debug看结构,在action中运行下面获取ValueStack<br><code>ValueStack valueStack=ActionContext.getContext().getValueStack();</code></p>
</li>
<li><p>让其跳转到一个页面，页面上加一个<code>&lt;s:debug/&gt;</code>,运行后点开<br><img src="index_files/c9b29e92-72b9-42ce-a542-2a79a59ed910.jpg" alt=""></p>
</li>
</ol>
<h3 id="ActionContext与值栈的关系"><a href="#ActionContext与值栈的关系" class="headerlink" title="ActionContext与值栈的关系"></a>ActionContext与值栈的关系</h3><ul>
<li><p>ActionContext：代表Action的上下文对象</p>
</li>
<li><p>通过源码查看：Struts的核心过滤器执行的过程中，创建ActionContext对象，在创建ActionContext对象的同时创建一个ValueStack，并且将ValueStack存入到ActionContext中。所以通过ActionContext对象，获得值栈。其实在ValueStack的内部有一个ActionContext的引用。</p>
</li>
<li><p>ActionContext中有ValueStack的引用，ValueStack中也有ActionStack的引用。</p>
</li>
<li><p><strong>ActionContext之所以之能访问Servlet的API其实也是依赖了值栈的。</strong></p>
</li>
</ul>
<h3 id="2-4如何获得值栈"><a href="#2-4如何获得值栈" class="headerlink" title="2.4如何获得值栈"></a>2.4如何获得值栈</h3><p>其实在request中也存放了ValueStack：<br>    核心过滤器—&gt;执行action—&gt;serviceAction—&gt;proxy代理类中。</p>
<ul>
<li><p>获取值栈：通过ActionContext获取</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ValueStack valueStack=ActionContext.getContext().getValueStack();</div></pre></td></tr></table></figure>
</li>
<li><p>通过request域对象</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ValueStack valueStack02=(ValueStack)ServletActionContext.getRequest().getAttribute(ServletActionContext.STRUTS_VALUESTACK_KEY);</div></pre></td></tr></table></figure>
<ul>
<li>两种获取值栈的方法是一样的，因为同一个action类只能加载一个值栈</li>
</ul>
<h3 id="如何操作值栈对象-操作root区"><a href="#如何操作值栈对象-操作root区" class="headerlink" title="如何操作值栈对象(操作root区)"></a>如何操作值栈对象(操作root区)</h3><h4 id="存入值栈"><a href="#存入值栈" class="headerlink" title="存入值栈"></a>存入值栈</h4><p>一. 直接操作值栈对象, 在值栈中封装数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">//void set(String name,Object value);   ----将数据封装到map集合中在存入，一般操作字符串</div><div class="line">valueStack.set(&quot;name&quot;,&quot;value&quot;);</div><div class="line"></div><div class="line"></div><div class="line">//void push(Object obj);    -----直接将对象压入值栈中，一般操作对象</div><div class="line">valueStack.push(User);</div></pre></td></tr></table></figure>
<p>二. 直接在Action对象中提供成员属性<br>   当Action的实例被创建了，默认的情况下(没有手动操作值栈，没有实现模型驱动)，Action对象在栈顶的位置，Action的属性也会在栈顶位置，提供一个属性，对该属性提供一个get方法就可以了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">public class valueStackAction extends ActionSupport&#123;</div><div class="line"></div><div class="line">    private String name;</div><div class="line"></div><div class="line">    public String getName()&#123;</div><div class="line">        return name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public String execute()&#123;</div><div class="line">        name=&quot;张三&quot;;</div><div class="line">        return SUCCESS;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="获取值栈（root）"><a href="#获取值栈（root）" class="headerlink" title="获取值栈（root）"></a>获取值栈（root）</h4><ul>
<li><p>在jsp中需要先引标签库，<code>&lt;%@ taglib uri=&quot;/struts-tags&quot; prefix=&quot;s&quot; %&gt;</code></p>
</li>
<li><p>使用OGNL表达式</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">//s:property标签中value的属性放的是OGNL的表达式</div><div class="line">//调用对象的方法</div><div class="line">&lt;s:property value=&quot;&apos;HelloWorld&apos;.length()&quot;/&gt;</div><div class="line"></div><div class="line">//调用静态对象的方法</div><div class="line">//在struts中默认关掉了静态访问的方法，需要开开，现在struts.xml配置常量</div><div class="line">&lt;s:property value=&quot;@java.lang.Math@random&quot;/&gt;</div></pre></td></tr></table></figure>
<ul>
<li>取出存入的值</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">//通过set存入的字符串值</div><div class="line">&lt;s:property value=&quot;name&quot;/&gt;</div><div class="line">//通过set存入的list集合,list集合中存放的对象中有name属性</div><div class="line">&lt;s:property value=&quot;list[0].name&quot;/&gt;</div><div class="line"></div><div class="line">//通过push存入对象</div><div class="line">&lt;s:property value=&quot;对象的属性&quot;/&gt;</div></pre></td></tr></table></figure>
<h3 id="操作context区域的区域"><a href="#操作context区域的区域" class="headerlink" title="操作context区域的区域"></a>操作context区域的区域</h3><h4 id="在action存"><a href="#在action存" class="headerlink" title="在action存"></a>在action存</h4><p>就是通过<code>ActionContext</code>对象,来操作API</p>
<h4 id="在jsp取"><a href="#在jsp取" class="headerlink" title="在jsp取"></a>在jsp取</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;s:property value=&quot;#session.name&quot;/&gt;</div><div class="line"></div><div class="line">&lt;s:property value=&quot;#request.name&quot;/&gt;</div><div class="line"></div><div class="line">&lt;s:property value=&quot;#appliaction.name&quot;/&gt;</div></pre></td></tr></table></figure>
<p><code>&lt;s:property value=&quot;#attr.name&quot;/&gt;</code> 表示取域最小中的值，没有的话找大一级的<br>pageContext /&lt; request /&lt; session /&lt; application</p>
<p><code>&lt;s:property value=&quot;#parameters.name&quot;/&gt;</code>表示取传过来的属性值，没有就为空</p>
<h3 id="EL也可以获取值栈的数据"><a href="#EL也可以获取值栈的数据" class="headerlink" title="EL也可以获取值栈的数据"></a>EL也可以获取值栈的数据</h3><p>EL也能获取到值栈的数据，因为过滤器中，会增强request，查看值栈中是否有数据，有的话存到request域中。</p>
<h2 id="OGNL中的特殊字符的使用"><a href="#OGNL中的特殊字符的使用" class="headerlink" title="OGNL中的特殊字符的使用"></a>OGNL中的特殊字符的使用</h2><h3 id="号"><a href="#号" class="headerlink" title="#号"></a>#号</h3><ul>
<li>获取context部分的数据</li>
<li>构建map集合</li>
</ul>
<p><img src="/uploads/Struts2/03/2a3e3632-08cd-4f74-841f-15bbfeaa0c93.jpg" alt=""></p>
<ul>
<li>单选按钮(其实也使用的map集合)</li>
</ul>
<p><img src="/uploads/Struts2/03/634585fd-dc75-4109-b392-f3016ca6a3c5.jpg" alt=""></p>
<p>或</p>
<p><img src="/uploads/Struts2/03/6dc1c33a-db02-4cc6-8df3-d4e7df7c5546.png" alt=""></p>
<h3 id="号-1"><a href="#号-1" class="headerlink" title="%号"></a>%号</h3><ul>
<li>强制解析OGNL表达式<br>数据回显的时候，取出域中的值</li>
</ul>
<p><img src="/uploads/Struts2/03/51c11578-000b-457c-85bb-48787684ee06.jpg" alt=""></p>
<ul>
<li>强制不解析OGNL表达式</li>
</ul>
<h3 id="符"><a href="#符" class="headerlink" title="$符"></a>$符</h3><ul>
<li>在配置文件中获取值栈中的数据(通过OGNL获取)。</li>
</ul>
<p>文件下载的时候：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;result type=&quot;stream&quot;&gt;</div><div class="line">   &lt;param name=&quot;Content-Disposition&quot;&gt;attachement;filename=$&#123;fileName&#125;&lt;/param&gt;</div><div class="line">&lt;/result&gt;</div></pre></td></tr></table></figure>
<p>国际化：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">message_zh_CN.properties</div><div class="line">name=您好：$&#123;#request.name&#125;</div><div class="line">message_en_US.properties</div><div class="line">name=Hello:$&#123;#request.name&#125;</div></pre></td></tr></table></figure>
<h2 id="OGNL遍历"><a href="#OGNL遍历" class="headerlink" title="OGNL遍历"></a>OGNL遍历</h2><p>前提是list是一个Customer类型的集合：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;s:iterator value=&quot;list&quot;&gt;</div><div class="line">  &lt;s:property value=&quot;custName&quot;/&gt;</div><div class="line">&lt;/s:iterator&gt;</div></pre></td></tr></table></figure>
<p>s标签不能嵌套s标签，html标签中能</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/13/Struts02/" itemprop="url">
                  Struts第二阶段
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-13T20:06:38+08:00" content="2016-06-13">
              2016-06-13
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/struts2/" itemprop="url" rel="index">
                    <span itemprop="name">struts2</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/13/Struts02/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/13/Struts02/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/06/13/Struts02/" class="leancloud_visitors" data-flag-title="Struts第二阶段">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="struts2"><a href="#struts2" class="headerlink" title="struts2"></a>struts2</h1><h2 id="Struts2访问Servlet的API"><a href="#Struts2访问Servlet的API" class="headerlink" title="Struts2访问Servlet的API"></a>Struts2访问Servlet的API</h2><h3 id="完全解耦和的方式实现Servlet的API的访问"><a href="#完全解耦和的方式实现Servlet的API的访问" class="headerlink" title="完全解耦和的方式实现Servlet的API的访问"></a>完全解耦和的方式实现Servlet的API的访问</h3><ul>
<li><p>获取<strong>ActionContext</strong><br><code>ActionContext actionContex=ActionContext.getContext();</code></p>
</li>
<li><p>接受参数：<br>解耦和的方式通过ActionContext中的方法实现：</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">Map&lt;String,Object&gt; getParamters(); //Object是一个字符串类型的数组</div><div class="line">Map&lt;String,Object&gt; getSession();</div><div class="line">Map&lt;String,Object&gt; getApplication();</div><div class="line">void setSession(Map&lt;String,Object&gt; session);</div><div class="line">void setApplication(Map&lt;String,Object&gt; application);</div><div class="line"></div><div class="line">//向request中存数据</div><div class="line">actionContext.put(String name,Object object);</div><div class="line">//向session中存数据</div><div class="line">actionContext.getSession.put(String name,Object object);</div><div class="line">//向application中存数据(ServletContext对象)</div><div class="line">actionContext.getApplication().put(String name,Object object);</div></pre></td></tr></table></figure>
<ul>
<li>post提交不用管中文action会管了,get提交需要设置</li>
</ul>
<h3 id="通过实现特定的接口来实现Servlet的API的访问"><a href="#通过实现特定的接口来实现Servlet的API的访问" class="headerlink" title="通过实现特定的接口来实现Servlet的API的访问"></a>通过实现特定的接口来实现Servlet的API的访问</h3><ul>
<li>让action类去实现<code>ServletRequestAware</code>接口，然后在成员位置定义一个HttpServletRequest变量，下边重写一个setServletRequest方法，让成员的request等于方法中的，可以当作正常的request用。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">public class RequestDemo2Action extends ActionSupport implements ServletRequestAware,ServletContextAware&#123;</div><div class="line"></div><div class="line">    private HttpServletRequest request ;</div><div class="line">    private ServletContext application;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public String execute() throws Exception &#123;</div><div class="line">        // 接收参数:需要使用request对象。</div><div class="line">        Map&lt;String, String[]&gt; parameterMap = request.getParameterMap();</div><div class="line">        for (String key : parameterMap.keySet()) &#123;</div><div class="line">            String[] value = parameterMap.get(key);</div><div class="line">            System.out.println(key+&quot;   &quot;+Arrays.toString(value));</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        // 向request域中存值:</div><div class="line">        request.setAttribute(&quot;reqName&quot;, &quot;r郝天一&quot;);</div><div class="line">        // 向session域中存值：</div><div class="line">        request.getSession().setAttribute(&quot;sessName&quot;, &quot;s郝思聪&quot;);</div><div class="line">        // 向application域中存值：</div><div class="line">        application.setAttribute(&quot;appName&quot;, &quot;a郝冠希&quot;);</div><div class="line">        return SUCCESS;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void setServletRequest(HttpServletRequest request) &#123;</div><div class="line">        this.request = request;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void setServletContext(ServletContext application) &#123;</div><div class="line">        this.application = application;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>如果想用ServletContext对象，则在实现一个ServletContextAwre接口，方式跟上边的一样。</li>
</ul>
<h3 id="通过ServletActionContext的静态方法实现Servlet的API的访问"><a href="#通过ServletActionContext的静态方法实现Servlet的API的访问" class="headerlink" title="通过ServletActionContext的静态方法实现Servlet的API的访问"></a>通过<strong>ServletActionContext</strong>的静态方法实现Servlet的API的访问</h3><blockquote>
<p>struts核心包中的api</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">//获取request对象</div><div class="line">HttpServletRequest request = ServletActionContext.getRequest();</div><div class="line">Map(String,String[]) paramterMap=request.getParameterMap();</div><div class="line">//获取ServletContext参数</div><div class="line">ServletContext application=ServletActionContext.getServletContext();</div></pre></td></tr></table></figure>
<h2 id="Struts2的数据的封装"><a href="#Struts2的数据的封装" class="headerlink" title="Struts2的数据的封装"></a>Struts2的数据的封装</h2><h3 id="Struts2的多例"><a href="#Struts2的多例" class="headerlink" title="Struts2的多例"></a>Struts2的多例</h3><ul>
<li>因为action是多例的，意思就是每次刷新页面都会重新执行action类<br>多例的话就可以使用成员变量，创建Service的时候，就可以放成全局。</li>
</ul>
<h3 id="属性驱动"><a href="#属性驱动" class="headerlink" title="属性驱动"></a>属性驱动</h3><blockquote>
<p>Struts既有控制层，又有模型层。</p>
</blockquote>
<ul>
<li>提供属性的set方法完成数据的封装<ul>
<li>在action类中，定义要接受的属性的成员变量，只提供set方法，即可获取属性值</li>
<li>这种方式应用的不多，因为还需要手动装到对象中。</li>
</ul>
</li>
</ul>
<p><img src="/uploads/Struts2/02/8814161f-0b48-4e9b-b962-1c422925523b.jpg" alt=""></p>
<ul>
<li><p>在页面中提供表达式（OGNL）的方式完成数据封装(直接封装到实体对象中)</p>
<ul>
<li><p>在页面中这样写<code>name</code>,前面的user必须跟action中成员方式的对象名一致。<br><img src="/uploads/Struts2/02/69931f38-7e2a-47ad-aacc-35e0d70a0a19.jpg" alt=""></p>
</li>
<li><p>在action类中的成员位置加一个实体类对象，并提供get跟set方法。</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"> public class User2Action  extends ActionSupport&#123;</div><div class="line">   private User user;</div><div class="line">   // 需要提供get和set方法:</div><div class="line">   public User getUser() &#123;</div><div class="line">       return user;</div><div class="line">   &#125;</div><div class="line">   public void setUser(User user) &#123;</div><div class="line">       this.user = user;</div><div class="line">   &#125;</div><div class="line">   @Override</div><div class="line">   public String execute() throws Exception &#123;</div><div class="line">       System.out.println(user);</div><div class="line">       return NONE;</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>注：</p>
<ul>
<li>在第二种方法中，必须有get set方法</li>
<li>因为属性驱动是在拦截器中执行的，他需要把action中的对象实例化，所以要get到，如果不给提供get方法，则，每次封装的时候都会自动创建一个新的实例对象，这样会导致使用这个对象时只会有第一个封装进来的值</li>
<li>拦截器在strut-default.xml中<br><img src="/uploads/Struts2/02/6d0f53d1-812a-4024-88d9-de6d50a10e5a.jpg" alt="">  </li>
</ul>
</li>
</ul>
<h3 id="模型驱动"><a href="#模型驱动" class="headerlink" title="模型驱动"></a>模型驱动</h3><p>采用模型驱动的方式来实现(推荐)：</p>
<ul>
<li>页面即用普通页面。</li>
<li>让action来实现一个 ModelDriver/<t>  接口,里面必须手动构建对象。<br>T是要封装的那个实体的类型<br><img src="/uploads/Struts2/02/dddd9695-1416-4c0d-b3f5-1cbacac9c855.jpg" alt=""></t></li>
</ul>
<hr>
<ul>
<li>OGNL表达式的方式和模型驱动都有使用的。<br>模型驱动通常会使用的方式。有一个缺点，就是只能封装到一个对象中，如果想封装到多个对象，就需要用到OGNL</li>
</ul>
<h3 id="Struts2中复杂类型数据的封装"><a href="#Struts2中复杂类型数据的封装" class="headerlink" title="Struts2中复杂类型数据的封装"></a>Struts2中复杂类型数据的封装</h3><h4 id="封装到List集合中"><a href="#封装到List集合中" class="headerlink" title="封装到List集合中"></a>封装到List集合中</h4><p>页面：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;h1&gt;批量插入商品&lt;/h1&gt;</div><div class="line">&lt;form action=&quot;$&#123; pageContext.request.contextPath &#125;/product1Action.action&quot; method=&quot;post&quot;&gt;</div><div class="line">    商品名称:&lt;input type=&quot;text&quot; name=&quot;list[0].name&quot;&gt;&lt;br/&gt;</div><div class="line">    商品价格:&lt;input type=&quot;text&quot; name=&quot;list[0].price&quot;&gt;&lt;br/&gt;</div><div class="line">    商品名称:&lt;input type=&quot;text&quot; name=&quot;list[1].name&quot;&gt;&lt;br/&gt;</div><div class="line">    商品价格:&lt;input type=&quot;text&quot; name=&quot;list[1].price&quot;&gt;&lt;br/&gt;</div><div class="line">    商品名称:&lt;input type=&quot;text&quot; name=&quot;list[2].name&quot;&gt;&lt;br/&gt;</div><div class="line">    商品价格:&lt;input type=&quot;text&quot; name=&quot;list[2].price&quot;&gt;&lt;br/&gt;</div><div class="line">    &lt;input type=&quot;submit&quot; value=&quot;批量导入&quot;&gt;</div><div class="line">&lt;/form&gt;</div></pre></td></tr></table></figure>
<p>Action：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * Struts2复杂数据类型的封装：封装到List集合中</div><div class="line"> * @author jt</div><div class="line"> *</div><div class="line"> */</div><div class="line">public class Product1Action extends ActionSupport&#123;</div><div class="line">    private List&lt;Product&gt; list;</div><div class="line">    </div><div class="line">    public List&lt;Product&gt; getList() &#123;</div><div class="line">        return list;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setList(List&lt;Product&gt; list) &#123;</div><div class="line">        this.list = list;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public String execute() throws Exception &#123;</div><div class="line">        for (Product product : list) &#123;</div><div class="line">            System.out.println(product);</div><div class="line">        &#125;</div><div class="line">        return NONE;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="封装到Map集合"><a href="#封装到Map集合" class="headerlink" title="封装到Map集合"></a>封装到Map集合</h4><p>页面:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;h1&gt;批量插入商品:封装到Map集合&lt;/h1&gt;</div><div class="line">&lt;form action=&quot;$&#123; pageContext.request.contextPath &#125;/product2Action.action&quot; method=&quot;post&quot;&gt;</div><div class="line">    商品名称:&lt;input type=&quot;text&quot; name=&quot;map[&apos;one&apos;].name&quot;&gt;&lt;br/&gt;</div><div class="line">    商品价格:&lt;input type=&quot;text&quot; name=&quot;map[&apos;one&apos;].price&quot;&gt;&lt;br/&gt;</div><div class="line">    商品名称:&lt;input type=&quot;text&quot; name=&quot;map[&apos;two&apos;].name&quot;&gt;&lt;br/&gt;</div><div class="line">    商品价格:&lt;input type=&quot;text&quot; name=&quot;map[&apos;two&apos;].price&quot;&gt;&lt;br/&gt;</div><div class="line">    商品名称:&lt;input type=&quot;text&quot; name=&quot;map[&apos;three&apos;].name&quot;&gt;&lt;br/&gt;</div><div class="line">    商品价格:&lt;input type=&quot;text&quot; name=&quot;map[&apos;three&apos;].price&quot;&gt;&lt;br/&gt;</div><div class="line">    &lt;input type=&quot;submit&quot; value=&quot;批量导入&quot;&gt;</div><div class="line">&lt;/form&gt;</div></pre></td></tr></table></figure>
<p>Action:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * Struts2的复杂数据的封装：Map集合的封装</div><div class="line"> * @author jt</div><div class="line"> *</div><div class="line"> */</div><div class="line">public class Product2Action extends ActionSupport&#123;</div><div class="line">    private Map&lt;String,Product&gt; map;</div><div class="line">    </div><div class="line">    public Map&lt;String, Product&gt; getMap() &#123;</div><div class="line">        return map;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setMap(Map&lt;String, Product&gt; map) &#123;</div><div class="line">        this.map = map;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public String execute() throws Exception &#123;</div><div class="line">        for (String key : map.keySet()) &#123;</div><div class="line">            Product product = map.get(key);</div><div class="line">            System.out.println(key+&quot;   &quot;+product);</div><div class="line">        &#125;</div><div class="line">        return NONE;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Struts中结果页面的配置"><a href="#Struts中结果页面的配置" class="headerlink" title="Struts中结果页面的配置"></a>Struts中结果页面的配置</h3><h4 id="结果页面的分类："><a href="#结果页面的分类：" class="headerlink" title="结果页面的分类："></a>结果页面的分类：</h4><ul>
<li>全局结果页面<ul>
<li>可以对所有的action都有效</li>
</ul>
</li>
<li>局部结果页面<ul>
<li>在 /&lt; action /&gt; 内部配置 /&lt; result /&gt; ,只会对当前的Action有效。</li>
</ul>
</li>
</ul>
<p>如果有全局页面跟局部页面同时存在的时候，首先要看局部页面。</p>
<h5 id="全局结果页面的配置"><a href="#全局结果页面的配置" class="headerlink" title="全局结果页面的配置"></a>全局结果页面的配置</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;package&gt;</div><div class="line">  &lt;global-results&gt;</div><div class="line">    &lt;result name=&quot;success&quot;&gt;地址。。。&lt;/result&gt;</div><div class="line">  &lt;/global-results&gt;</div><div class="line">&lt;/package&gt;</div></pre></td></tr></table></figure>
<h5 id="局部结果页面的配置"><a href="#局部结果页面的配置" class="headerlink" title="局部结果页面的配置"></a>局部结果页面的配置</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;package&gt;</div><div class="line">  &lt;action&gt;</div><div class="line">    &lt;result name=&quot;success&quot;&gt;地址。。。&lt;/result&gt;</div><div class="line">  &lt;/action&gt;</div><div class="line">&lt;/package&gt;</div></pre></td></tr></table></figure>
<h4 id="Struts2结果页面类型的配置"><a href="#Struts2结果页面类型的配置" class="headerlink" title="Struts2结果页面类型的配置"></a>Struts2结果页面类型的配置</h4><ul>
<li>/&lt; result /&gt; 标签上还有一个属性：<ul>
<li>name ：逻辑视图名称。</li>
<li>type ：页面跳转的类型<ul>
<li>dispather ：默认值，转发，转发到jsp页面</li>
<li>chain ：转发到一个Action</li>
<li>redirect ：重定向。重定向到jsp</li>
<li>redirectAction ：重定向到一个Action，重定向的时候如果不是在一个命名空间中，可以自己加上属性，（在result下面加param标签）</li>
<li>stream ：文件下载的时候</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="struts2中内置数据类型的转换"><a href="#struts2中内置数据类型的转换" class="headerlink" title="struts2中内置数据类型的转换"></a>struts2中内置数据类型的转换</h3><ul>
<li><p>会把传过来的特殊数据类型转换为实体中需要的类型，integer，<code>date</code>都能封装。 都是在拦截器执行的。</p>
</li>
<li><p>当转换失败时，会到<code>Workflow</code>拦截器，然后查看是否有这个错误，如果有会运行一个input视图中有错误信息，跳转到<code>input</code>的页面中。 例如Integer中添了一个字母。</p>
<ul>
<li>可以在配置文件中，设置一个input的跳转页面，当有错误时，会跳转到这个页面</li>
<li>这个页面中可以加一个标签，显示错误信息</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">   &lt;%@ taglib uri=&quot;/struts-tags&quot; prefix=&quot;s&quot; %&gt;</div><div class="line">   //可以加两个标签，是哪个错误会显示哪个错误</div><div class="line">   &lt;s:actionerror/&gt;</div><div class="line">   &lt;s:fielderror/&gt;</div></pre></td></tr></table></figure>
<h3 id="注："><a href="#注：" class="headerlink" title="注："></a>注：</h3><ul>
<li><p>有的时候elipse会编译前一段时间的代码，修改之后不会及时编译最新的，可以把tomcat中的webapps项目中的class文件删除，然后再在elispe中，project/build all手动编译一下。</p>
</li>
<li><p>struts2中的带的log4j是2.2版本的，hibernate中是1.几版本的，所以不能把hibernate中的配置文件中copy过来直接用，可以在struts2提供的项目模板中找一个，2.2版本的配置文件是 .xml 的</p>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/10/Struts01/" itemprop="url">
                  Struts第一阶段
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-10T21:06:29+08:00" content="2016-06-10">
              2016-06-10
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/struts2/" itemprop="url" rel="index">
                    <span itemprop="name">struts2</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/10/Struts01/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/10/Struts01/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/06/10/Struts01/" class="leancloud_visitors" data-flag-title="Struts第一阶段">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="strust2入门与介绍"><a href="#strust2入门与介绍" class="headerlink" title="strust2入门与介绍"></a>strust2入门与介绍</h1><h2 id="什么是Struts2"><a href="#什么是Struts2" class="headerlink" title="什么是Struts2"></a>什么是Struts2</h2><p>是基于MVC设计模式的<code>WEB</code>层框架</p>
<h2 id="WEB层框架"><a href="#WEB层框架" class="headerlink" title="WEB层框架"></a>WEB层框架</h2><p>Struts1，WebWork，Struts2，SpringMVC</p>
<p>Struts2的内核是基于WebWork的</p>
<h2 id="前端控制器模式"><a href="#前端控制器模式" class="headerlink" title="前端控制器模式"></a>前端控制器模式</h2><p><img src="/uploads/Struts2/01/ea699e92-9b6e-4355-b3e7-638eb49a16b2.jpg" alt=""></p>
<h2 id="Struts2的入门"><a href="#Struts2的入门" class="headerlink" title="Struts2的入门"></a>Struts2的入门</h2><ol>
<li>解压之后：</li>
</ol>
<ul>
<li>apps ：Struts2 里面提供的一些测试的应用</li>
<li>docs ：Struts2 里面的帮助文档</li>
<li>lib  ：Struts2的提供的开发的jar包</li>
<li>src  ：Struts2提供的源码</li>
</ul>
<ol>
<li>导包，导最少的包，找到blank项目下的jar包，导这些即可</li>
<li>写一个jsp页面，跳转的目标的路径是<code>xxx.action</code>.</li>
</ol>
<p><code>&lt;h3&gt; &lt;a href=&quot;${pageContext.request.contextPath}/hello.action&quot;&gt;访问Struts2框架&lt;/a&gt;&lt;/h3&gt;</code></p>
<ol>
<li>配置Struts2的核心过滤器，前端控制器(完成部分功能)，会默认执行拦截器（过滤器路径在<code>struts2-core/包后边是filter/StrutsPrepareAndExecuteFilter.class</code>），然后会跳到配置文件中</li>
<li><p>写action类里面有一个execute方法，方法的格式是固定的：<br>必须是public ，返回值是String，方法名execute，方法中没有参数</p>
</li>
<li><p>配置action类的配置文件<br> struts2默认的配置文件是<code>struts.xml</code>，写在src下。</p>
<ul>
<li>配置文件写法：copy约束，struts标签，里边有package<ul>
<li>package标签属性：name   extends   namespace</li>
<li>package里边有action：name     class类action的全路径</li>
</ul>
</li>
</ul>
</li>
<li>修改struts2配置文件：加一个result标签<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;struts&gt;</div><div class="line">   &lt;package name=&quot;demo01&quot; extends=&quot;struts-default&quot; namespace=&quot;/&quot;&gt;</div><div class="line">       &lt;action name=&quot;jsp中的xxx&quot; class=&quot;类action的全路径&quot;&gt;</div><div class="line">           &lt;result name=&quot;success(action传过来的字符串)&quot;&gt;要跳转的路径&lt;/result&gt;</div><div class="line">       &lt;/action&gt;</div><div class="line">   &lt;/package&gt;</div><div class="line">&lt;/struts&gt;</div></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="struts2的执行流程"><a href="#struts2的执行流程" class="headerlink" title="struts2的执行流程"></a>struts2的执行流程</h2><p>当一个页面发送一个请求的时候，首先经过<code>核心过滤器(StrutsPrepareAndExecuteFilter)</code>,在这个过滤器中其实会执行一组<code>拦截器</code>(这组拦截器就完成了部分的功能)，执行完这组拦截器之后，执行<code>目标Action</code>，返回一个结果视图，根据返回结果跳转不同界面。</p>
<h2 id="struts2常见的配置"><a href="#struts2常见的配置" class="headerlink" title="struts2常见的配置"></a>struts2常见的配置</h2><h3 id="struts2的配置文件的加载顺序：（了解）"><a href="#struts2的配置文件的加载顺序：（了解）" class="headerlink" title="struts2的配置文件的加载顺序：（了解）"></a>struts2的配置文件的加载顺序：（了解）</h3><p>过滤器<code>StrutsPrepareAndExecuteFilter</code>会在服务器启动时初始化。<br>在过滤器中会执行<code>dispatcher = init.initDispatcher(config);</code>,然后在执行<code>dispatcher.init();</code>,再然后会执行下面的配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">init_DefaultProperties(); // [1]                -----default.properties 核心包里第一个包下边呢</div><div class="line">init_TraditionalXmlConfigurations(); // [2]        -----struts-default.xml,struts-plugin.xml,struts.xml</div><div class="line">init_LegacyStrutsProperties(); // [3]            -----struts.properties</div><div class="line">init_CustomConfigurationProviders(); // [5]        -----客户自定义提供类</div><div class="line">init_FilterInitParameters() ; // [6]            -----加载web.xml中过滤器中的参数</div><div class="line">init_AliasStandardObjects() ; // [7]            -----加载自定义类</div></pre></td></tr></table></figure>
<p>这几个值规定了加载配配置文件的顺序:</p>
<ul>
<li>default.properties</li>
<li>struts-default.xml</li>
<li>struts-plugin.xml</li>
<li><code>struts.xml</code></li>
<li><code>struts.properties</code></li>
<li><code>web.xml</code></li>
</ul>
<p><strong>主要用的后三个，顺序是由上到下</strong></p>
<h3 id="struts2的主要配置文件："><a href="#struts2的主要配置文件：" class="headerlink" title="struts2的主要配置文件："></a>struts2的主要配置文件：</h3><h4 id="struts2中Action的配置-struts-xml"><a href="#struts2中Action的配置-struts-xml" class="headerlink" title="struts2中Action的配置(struts.xml)"></a>struts2中Action的配置(struts.xml)</h4><ol>
<li><p>包的配置(package)</p>
<p>Struts2为了更好的管理Action，将Action分包进行管理的。</p>
<ul>
<li>/&lt; package /&gt;包中的顺序<ul>
<li>name  :包名，一个配置文件中不要出现重复的包名</li>
<li>extends：继承别的包，通常继承struts-default</li>
<li>namespace：<strong>名称空间</strong>，跟下边的/<action>中的name属性共同决定访问路劲<ul>
<li>namespace=””;      最后在找这个，在/之后</li>
<li>namespace=”/“;     没有指定的名称的执行这个，一般就会写这个</li>
<li>namespace=”/aaa”;  首先找带名称空间的，这个是最大化</li>
</ul>
</action></li>
<li>abstract：是否可以被别的包继承，true表示可以应用于其他包的继承</li>
</ul>
</li>
</ul>
</li>
<li><p>Action的配置</p>
<ul>
<li>/&lt; action /&gt; 的配置<ul>
<li>name：与名称空间共同决定访问路劲</li>
<li>class：Action类的全路径</li>
<li>method：Action中要执行的方法的名称，默认值execute</li>
</ul>
</li>
</ul>
</li>
</ol>
<h4 id="Structs2中常量的位置"><a href="#Structs2中常量的位置" class="headerlink" title="Structs2中常量的位置"></a>Structs2中常量的位置</h4><p>Struct中常量有三个配置的位置:</p>
<ul>
<li><p>struts.xml（推荐）<br><code>&lt;constant name=&quot;struts.action.extension&quot; value=&quot;action&quot;&gt;</code></p>
</li>
<li><p>struts.properties<br><code>struts.actioin.extension=action</code></p>
</li>
<li><p>web.xml</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">  // &lt;filter&gt;中加一个</div><div class="line">  &lt;init-param&gt;</div><div class="line">     &lt;param-name&gt;struts.actioin.extension&lt;/param-name&gt;</div><div class="line">     &lt;param-value&gt;action&lt;/param-value&gt;</div><div class="line">  &lt;/init-param&gt;</div></pre></td></tr></table></figure>
<p>这里的struts.actioin.extension常量，表示访问的时候，路径的后缀名要加什么，默认是<code>action, ,</code>表示action跟空</p>
<h4 id="Struts2分模块开发的配置"><a href="#Struts2分模块开发的配置" class="headerlink" title="Struts2分模块开发的配置"></a>Struts2分模块开发的配置</h4><p>在struts2.xml 配置文件中用<code>&lt;include file=&quot;要包含的子配置文件&quot;/&gt;</code></p>
<h3 id="Action的编写"><a href="#Action的编写" class="headerlink" title="Action的编写"></a>Action的编写</h3><h4 id="Action本身是一个POJO的类"><a href="#Action本身是一个POJO的类" class="headerlink" title="Action本身是一个POJO的类"></a>Action本身是一个POJO的类</h4><p>POJO(plain ordinary java object)的类,简单的java类：没有继承任何类。</p>
<h4 id="Action实现一个Action的接口"><a href="#Action实现一个Action的接口" class="headerlink" title="Action实现一个Action的接口"></a>Action实现一个Action的接口</h4><p>在action的接口中，提供了个常量（逻辑视图名称）</p>
<ul>
<li>SUCCESS ：成功</li>
<li>NONE    ：不跳转</li>
<li>ERROR   ：跳转到错误的页面</li>
<li>INPUT   ：表单校验</li>
<li>LOGIN   ：跳转到登陆页面</li>
</ul>
<h4 id="Action继承一个ActionSupport的类"><a href="#Action继承一个ActionSupport的类" class="headerlink" title="Action继承一个ActionSupport的类"></a>Action继承一个ActionSupport的类</h4><p>ActionSupport实现Action的接口，还有好多扩展的方法<br>在父类里面的execute里，直接返回的SUCCESS。</p>
<p>以后写的时候最好使用这种方法。</p>
<h3 id="Action的访问"><a href="#Action的访问" class="headerlink" title="Action的访问"></a>Action的访问</h3><p>现在已经可以访问到Action，但是一次请求对应了一个Action的，需要一个模块的多次请求添加到一个Action中。</p>
<h4 id="可以在struts-xml中配配置"><a href="#可以在struts-xml中配配置" class="headerlink" title="可以在struts.xml中配配置"></a>可以在struts.xml中配配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">//页面</div><div class="line">&lt;h1&gt;客户管理&lt;/h1&gt;</div><div class="line"></div><div class="line">&lt;h3&gt;&lt;a href=&quot;$&#123; pageContext.request.contextPath &#125;/addCustomer.action&quot;&gt;添加客户&lt;/a&gt;&lt;/h3&gt;</div><div class="line">&lt;h3&gt;&lt;a href=&quot;$&#123; pageContext.request.contextPath &#125;/findCustomer.action&quot;&gt;查询客户&lt;/a&gt;&lt;/h3&gt;</div><div class="line">&lt;h3&gt;&lt;a href=&quot;$&#123; pageContext.request.contextPath &#125;/updateCustomer.action&quot;&gt;修改客户&lt;/a&gt;&lt;/h3&gt;</div><div class="line">&lt;h3&gt;&lt;a href=&quot;$&#123; pageContext.request.contextPath &#125;/deleteCustomer.action&quot;&gt;删除客户&lt;/a&gt;&lt;/h3&gt;</div><div class="line"></div><div class="line">//编写action</div><div class="line">public class CustomerAction extends ActionSupport&#123;</div><div class="line"></div><div class="line">    public String add()&#123;</div><div class="line">        System.out.println(&quot;保存客户...&quot;);</div><div class="line">        return NONE;</div><div class="line">    &#125;</div><div class="line">    public String find()&#123;</div><div class="line">        System.out.println(&quot;查询客户...&quot;);</div><div class="line">        return NONE;</div><div class="line">    &#125;</div><div class="line">    public String update()&#123;</div><div class="line">        System.out.println(&quot;修改客户...&quot;);</div><div class="line">        return NONE;</div><div class="line">    &#125;</div><div class="line">    public String delete()&#123;</div><div class="line">        System.out.println(&quot;删除客户...&quot;);</div><div class="line">        return NONE;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">//配置action</div><div class="line">&lt;!-- 配置package包 --&gt;</div><div class="line">    &lt;package name=&quot;demo3&quot; extends=&quot;struts-default&quot; namespace=&quot;/&quot;&gt;</div><div class="line">        &lt;!-- 配置action --&gt;</div><div class="line">        &lt;action name=&quot;addCustomer&quot; class=&quot;com.itheima.struts2.action3.CustomerAction&quot; method=&quot;add&quot;/&gt;</div><div class="line">        &lt;action name=&quot;findCustomer&quot; class=&quot;com.itheima.struts2.action3.CustomerAction&quot; method=&quot;find&quot;/&gt;</div><div class="line">        &lt;action name=&quot;updateCustomer&quot; class=&quot;com.itheima.struts2.action3.CustomerAction&quot; method=&quot;update&quot;/&gt;</div><div class="line">        &lt;action name=&quot;deleteCustomer&quot; class=&quot;com.itheima.struts2.action3.CustomerAction&quot; method=&quot;delete&quot;/&gt;</div><div class="line">    &lt;/package&gt;</div></pre></td></tr></table></figure>
<h4 id="通配符的方式"><a href="#通配符的方式" class="headerlink" title="通配符的方式"></a>通配符的方式</h4><p>//第一个*代表的数就是传过来的那个参数的后部分，正好是method里的东西</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">//页面</div><div class="line">&lt;h1&gt;商品管理&lt;/h1&gt;</div><div class="line">&lt;h3&gt;&lt;a href=&quot;$&#123; pageContext.request.contextPath &#125;/product_add.action&quot;&gt;添加客户&lt;/a&gt;&lt;/h3&gt;</div><div class="line">&lt;h3&gt;&lt;a href=&quot;$&#123; pageContext.request.contextPath &#125;/product_find.action&quot;&gt;查询客户&lt;/a&gt;&lt;/h3&gt;</div><div class="line">&lt;h3&gt;&lt;a href=&quot;$&#123; pageContext.request.contextPath &#125;/product_update.action&quot;&gt;修改客户&lt;/a&gt;&lt;/h3&gt;</div><div class="line">&lt;h3&gt;&lt;a href=&quot;$&#123; pageContext.request.contextPath &#125;/product_delete.action&quot;&gt;删除客户&lt;/a&gt;&lt;/h3&gt;</div><div class="line"></div><div class="line">//编写Action</div><div class="line">public class ProductAction extends ActionSupport&#123;</div><div class="line"></div><div class="line">    public String add()&#123;</div><div class="line">        System.out.println(&quot;保存商品...&quot;);</div><div class="line">        return NONE;</div><div class="line">    &#125;</div><div class="line">    public String find()&#123;</div><div class="line">        System.out.println(&quot;查询商品...&quot;);</div><div class="line">        return NONE;</div><div class="line">    &#125;</div><div class="line">    public String update()&#123;</div><div class="line">        System.out.println(&quot;修改商品...&quot;);</div><div class="line">        return NONE;</div><div class="line">    &#125;</div><div class="line">    public String delete()&#123;</div><div class="line">        System.out.println(&quot;删除商品...&quot;);</div><div class="line">        return NONE;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">//配置Action:</div><div class="line">        &lt;!-- 通配符的方式的配置 --&gt;</div><div class="line">        &lt;action name=&quot;product_*&quot; class=&quot;com.itheima.struts2.action3.ProductAction&quot; method=&quot;&#123;1&#125;&quot;/&gt;</div></pre></td></tr></table></figure>
<p>更通配的写法：<br><img src="/uploads/Struts2/01/1d7bc130-8656-419f-af1a-7df299e7522c.png" alt=""></p>
<h4 id="动态方法访问"><a href="#动态方法访问" class="headerlink" title="动态方法访问"></a>动态方法访问</h4><pre><code>在struts2中默认是关闭的，需要开启，在default.porperties中，需要在配置文件中修改称true
</code></pre><p><code>&lt;constant name=&quot;struts.enable.DynamicMethodInvocation&quot; value=&quot;true&quot;&gt;</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">//页面</div><div class="line">&lt;h1&gt;订单管理&lt;/h1&gt;</div><div class="line">&lt;h3&gt;&lt;a href=&quot;$&#123; pageContext.request.contextPath &#125;/order!add.action&quot;&gt;添加订单&lt;/a&gt;&lt;/h3&gt;</div><div class="line">&lt;h3&gt;&lt;a href=&quot;$&#123; pageContext.request.contextPath &#125;/order!find.action&quot;&gt;查询订单&lt;/a&gt;&lt;/h3&gt;</div><div class="line">&lt;h3&gt;&lt;a href=&quot;$&#123; pageContext.request.contextPath &#125;/order!update.action&quot;&gt;修改订单&lt;/a&gt;&lt;/h3&gt;</div><div class="line">&lt;h3&gt;&lt;a href=&quot;$&#123; pageContext.request.contextPath &#125;/order!delete.action&quot;&gt;删除订单&lt;/a&gt;&lt;/h3&gt;</div><div class="line"></div><div class="line">//配置。不用写method</div><div class="line">&lt;!-- 动态方法的访问 --&gt;</div><div class="line">&lt;action name=&quot;order&quot; class=&quot;com.itheima.struts2.action3.OrderAction&quot;/&gt;</div></pre></td></tr></table></figure>
<p>跳转之后，如果result里边是success可以省略。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/17/Hibernate04/" itemprop="url">
                  Hibernate第四阶段
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-17T22:52:50+08:00" content="2016-05-17">
              2016-05-17
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Hibernate/" itemprop="url" rel="index">
                    <span itemprop="name">Hibernate</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/17/Hibernate04/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/17/Hibernate04/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/05/17/Hibernate04/" class="leancloud_visitors" data-flag-title="Hibernate第四阶段">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Hibernate"><a href="#Hibernate" class="headerlink" title="Hibernate"></a>Hibernate</h1><p>[TOC]</p>
<h2 id="1-Hibernate的检索方式"><a href="#1-Hibernate的检索方式" class="headerlink" title="1.Hibernate的检索方式"></a>1.Hibernate的检索方式</h2><p>Hibernate提供对于对象的查询的方式</p>
<h3 id="1-1Hibernate中五种查询方式"><a href="#1-1Hibernate中五种查询方式" class="headerlink" title="1.1Hibernate中五种查询方式"></a>1.1Hibernate中五种查询方式</h3><h4 id="1-1-1OID检索：根据主键查询"><a href="#1-1-1OID检索：根据主键查询" class="headerlink" title="1.1.1OID检索：根据主键查询"></a>1.1.1OID检索：根据主键查询</h4><pre><code>+ session 中的get 和load方法
</code></pre><h4 id="1-1-2对象导航检索：通过一个对象获得到其关联对象。"><a href="#1-1-2对象导航检索：通过一个对象获得到其关联对象。" class="headerlink" title="1.1.2对象导航检索：通过一个对象获得到其关联对象。"></a>1.1.2对象导航检索：通过一个对象获得到其关联对象。</h4><p><code>LinkMan linkMan = session.get(LinkMan.class,1L);Customer customer=Linkman.getCustomer();</code></p>
<h4 id="1-1-3HQL-检索：通过编写一个HQL语句检索"><a href="#1-1-3HQL-检索：通过编写一个HQL语句检索" class="headerlink" title="1.1.3HQL 检索：通过编写一个HQL语句检索"></a>1.1.3HQL 检索：通过编写一个HQL语句检索</h4><h5 id="1-1-3-1HQL的基本的查询，别名查询，排序查询"><a href="#1-1-3-1HQL的基本的查询，别名查询，排序查询" class="headerlink" title="1.1.3.1HQL的基本的查询，别名查询，排序查询"></a>1.1.3.1HQL的基本的查询，别名查询，排序查询</h5><p> 在创建实体类的时候，生成toString的时候，不要把两个实体都生成，要不会互相打印，形成死循环，可以去掉一个set集合</p>
<ul>
<li>查询全部<br>//里面不能使用select * .</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">Query query = session.createQuery(&quot;from Customer c&quot;);  //给Customer取得别名</div><div class="line">List&lt;Customer&gt; lists=query.list();</div><div class="line"></div><div class="line">//也可以这么写</div><div class="line">List&lt;Customer&gt; list=session.createQuery(&quot;select c from Customer c&quot;).list();</div><div class="line"></div><div class="line">//HQL还支持多肽查询,查询所有Object下的持久化类</div><div class="line">Query query=session.createQuery(&quot;from java.util.Object&quot;);</div><div class="line">List&lt;Object&gt; lists=query.list();</div></pre></td></tr></table></figure>
<ul>
<li>排序查询</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//默认asc，可以加desc降序</div><div class="line">List&lt;Customer&gt; list=session.createQuery(&quot;from Customer order by cust_id&quot;).list();</div></pre></td></tr></table></figure>
<h5 id="1-1-3-2HQL的条件查询"><a href="#1-1-3-2HQL的条件查询" class="headerlink" title="1.1.3.2HQL的条件查询"></a>1.1.3.2HQL的条件查询</h5><ol>
<li>按位置绑定参数</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Query query = session.createQuery(&quot;from Customer where cust_name=? and cust_id=?&quot;);</div><div class="line">query.setParameter(0,&quot;...&quot;);</div><div class="line">query.setParameter(1,&quot;...&quot;);</div><div class="line">List&lt;Customer&gt; lists=query.list();</div><div class="line">//如果确定一条结果可以用</div><div class="line">Customer customer=(Customer) query.uniqueResult();</div></pre></td></tr></table></figure>
<ol>
<li>按名称绑定参数</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Query query = session.createQuery(&quot;from Customer where cust_name=:name and cust_id=:id&quot;);</div><div class="line">query.setParameter(&quot;name&quot;,&quot;...&quot;);</div><div class="line">query.setParameter(&quot;id&quot;,&quot;...&quot;);</div><div class="line">List&lt;Customer&gt; lists=query.list();</div><div class="line">//如果确定一条结果可以用</div><div class="line">Customer customer=(Customer) query.uniqueResult();</div></pre></td></tr></table></figure>
<h5 id="1-1-3-3HQL的分页查询"><a href="#1-1-3-3HQL的分页查询" class="headerlink" title="1.1.3.3HQL的分页查询"></a>1.1.3.3HQL的分页查询</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Query query = session.createQuery(&quot;from LinkMan&quot;);</div><div class="line">query.setFirstResult(0);</div><div class="line">query.setMAxResults(10);</div><div class="line">List&lt;LinkMan&gt; lists=query.list();</div></pre></td></tr></table></figure>
<h5 id="1-1-3-4HQL的投影查询"><a href="#1-1-3-4HQL的投影查询" class="headerlink" title="1.1.3.4HQL的投影查询"></a>1.1.3.4HQL的投影查询</h5><ol>
<li>查询所有的名字</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Query query = session.createQuery(&quot;select cust_name from Customer&quot;);</div><div class="line">List&lt;String&gt; names=query.list();</div></pre></td></tr></table></figure>
<ol>
<li>查询所有客户的id和名称</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Query query = session.createQuery(&quot;select cust_id,cust_name from Customer&quot;);</div><div class="line">List&lt;Object[]&gt; lists=query.list();</div><div class="line">for(Object[] objects : list)&#123;</div><div class="line">   System.out.println(Arrays.toString(objects));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li>构造查询,现在实体类中写出相应的构造方法<br>//不要忘了加无参构造</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Query query = session.createQuery(&quot;select new Customer(cyst_id,cust_name) from Customer&quot;);</div><div class="line">List&lt;Customer&gt; lists=query.list();</div></pre></td></tr></table></figure>
<h5 id="1-1-3-5HQL的分组统计查询"><a href="#1-1-3-5HQL的分组统计查询" class="headerlink" title="1.1.3.5HQL的分组统计查询"></a>1.1.3.5HQL的分组统计查询</h5><ol>
<li>统计个数</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Query query = session.createQuery(&quot;select count(*) from Customer&quot;);</div><div class="line">Long count=query.uniqueResult();</div></pre></td></tr></table></figure>
<ol>
<li>按名称分组统计</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Query query = session.createQuery(&quot;select cust_name,count(*) from Customer group by cust_name&quot;);</div><div class="line">List&lt;Object[]&gt; lists=query.list();</div><div class="line">for(Object[] objects : list)&#123;</div><div class="line">   System.out.println(Arrays.toString(objects));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li>按姓氏的名称统计个数</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Query query = session.createQuery(&quot;select cust_name,count(*) from Customer where cust_name like ? group by cust_name&quot;);</div><div class="line">query.setParameter(0,&quot;郝%&quot;);</div><div class="line">List&lt;Object[]&gt; lists=query.list();</div><div class="line">for(Object[] objects : list)&#123;</div><div class="line">   System.out.println(Arrays.toString(objects));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="1-1-4QBC-检索：通过Criteria对象进行检索"><a href="#1-1-4QBC-检索：通过Criteria对象进行检索" class="headerlink" title="1.1.4QBC 检索：通过Criteria对象进行检索"></a>1.1.4QBC 检索：通过Criteria对象进行检索</h4><h5 id="1-1-4-1基本查询"><a href="#1-1-4-1基本查询" class="headerlink" title="1.1.4.1基本查询"></a>1.1.4.1基本查询</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Criteria criteria=session.createCriteria(Customer.class);</div><div class="line">List&lt;Customer&gt; list=criteria.list();</div></pre></td></tr></table></figure>
<h5 id="1-1-4-2排序查询"><a href="#1-1-4-2排序查询" class="headerlink" title="1.1.4.2排序查询"></a>1.1.4.2排序查询</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Criteria criteria=session.createCriteria(Customer.class);</div><div class="line">criteria.addOrder(Order.asc(&quot;cust_id&quot;)); //倒序换为desc即可</div><div class="line">List&lt;Customer&gt; list=criteria.list();</div></pre></td></tr></table></figure>
<h5 id="1-1-4-3条件查询"><a href="#1-1-4-3条件查询" class="headerlink" title="1.1.4.3条件查询"></a>1.1.4.3条件查询</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Criteria criteria=session.createCriteria(Customer.class);</div></pre></td></tr></table></figure>
<ul>
<li>crteria.add(Restrictions.下边的值());</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"> == eq</div><div class="line"> &gt; gt great than</div><div class="line"> &gt;= ge great equal</div><div class="line"> &lt; lt less than</div><div class="line"> &lt;= le less equal</div><div class="line"> &lt;&gt; ne not equal</div><div class="line">like 模糊查询</div><div class="line"></div><div class="line">like模糊查询还有一种方式</div><div class="line">//MatchMode.START指的是前面的字在哪个位置</div><div class="line">crteria.add(Restrictions.like(&quot;cust_name&quot;,&quot;郝&quot;，MatchMode.START));</div></pre></td></tr></table></figure>
<p>//crteria.add(Restrictions.。。  可以写多个，相当于and</p>
<h5 id="1-1-4-4分页查询"><a href="#1-1-4-4分页查询" class="headerlink" title="1.1.4.4分页查询"></a>1.1.4.4分页查询</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Criteria criteria=session.createCriteria(Customer.class);</div><div class="line">crteria.add(Restrictions.like(&quot;cust_name&quot;,&quot;郝&quot;));</div><div class="line">crteria.setFirstResult(2);</div><div class="line">crteria.setMaxResult(2);</div><div class="line">List&lt;Customer&gt; lists=criteria.list();</div></pre></td></tr></table></figure>
<h5 id="1-1-4-5统计查询"><a href="#1-1-4-5统计查询" class="headerlink" title="1.1.4.5统计查询"></a>1.1.4.5统计查询</h5><p>setProjection 是单独值，用来设置聚集函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Criteria criteria=session.createCriteria(Customer.class);</div><div class="line">crteria.setProjection(Projections.rowCount());</div><div class="line">Object result=criteria.uniqueResult();</div></pre></td></tr></table></figure>
<h5 id="1-1-4-6离线查询-DetachedCriteria"><a href="#1-1-4-6离线查询-DetachedCriteria" class="headerlink" title="1.1.4.6离线查询 DetachedCriteria"></a>1.1.4.6离线查询 DetachedCriteria</h5><p>这个对象可以前期脱离session来使用，后期再绑定session。<br>所以可以在web层中封装好一个DetachedCriteria对象，然后传到dao中，在调用getExecutableCriteria(session); 获取一个Criteria对象使用</p>
<p><img src="/uploads/Hibernate/04/1.png" alt=""></p>
<h4 id="1-1-5SQL检索-：通过输入SQL语句进行检索"><a href="#1-1-5SQL检索-：通过输入SQL语句进行检索" class="headerlink" title="1.1.5SQL检索 ：通过输入SQL语句进行检索"></a>1.1.5SQL检索 ：通过输入SQL语句进行检索</h4><h3 id="1-2-多表查询"><a href="#1-2-多表查询" class="headerlink" title="1.2 多表查询"></a>1.2 多表查询</h3><h4 id="1-2-1-SQL中连接查询"><a href="#1-2-1-SQL中连接查询" class="headerlink" title="1.2.1 SQL中连接查询"></a>1.2.1 SQL中连接查询</h4><h4 id="1-2-2-HQL中的连接查询"><a href="#1-2-2-HQL中的连接查询" class="headerlink" title="1.2.2 HQL中的连接查询"></a>1.2.2 HQL中的连接查询</h4><p>sql连接<br><img src="/uploads/Hibernate/04/2.png" alt=""></p>
<ul>
<li><p>交叉连接</p>
</li>
<li><p>内连接</p>
<ul>
<li>隐式内连接，显式内连接<br><img src="/uploads/Hibernate/04/3.png" alt=""></li>
<li>迫切内连接<br><img src="/uploads/Hibernate/04/4.png" alt=""><br><code>fetch</code>可以通知Hibernate，把结果封装成一个<code>customer对象</code>，包括集合<br> 但是有一个问题：封装对象的时候会有重复的对象，所以要去重<br><img src="/uploads/Hibernate/04/5.png" alt=""></li>
</ul>
</li>
<li><p>外连接</p>
<ul>
<li>左外连接</li>
<li>右外连接</li>
<li>迫切外连接<br>跟内连接一样加一个 <code>fetch</code></li>
</ul>
</li>
</ul>
<h2 id="2-Hibernate的抓取策略"><a href="#2-Hibernate的抓取策略" class="headerlink" title="2.Hibernate的抓取策略"></a>2.Hibernate的抓取策略</h2><h3 id="2-1Hibernate延迟加载机制"><a href="#2-1Hibernate延迟加载机制" class="headerlink" title="2.1Hibernate延迟加载机制"></a>2.1Hibernate延迟加载机制</h3><p>   延迟加载(懒加载 lazy):指的是，当执行到这行操作的时候，不会马上与数据库进行交互，等到真正使用该对象的属性的时候，才会发送sql语句进行查询。</p>
<h4 id="2-1-1类级别的延迟加载"><a href="#2-1-1类级别的延迟加载" class="headerlink" title="2.1.1类级别的延迟加载"></a>2.1.1类级别的延迟加载</h4><p>类级别的延迟加载：查询某个类(对象)的时候，这个对象是否采用延迟。<br>主要体现在使用load方法查询某个对象的时候，这个对象是否采用了延迟加载(默认使用延迟加载)</p>
<ul>
<li>使类级别的延迟加载失效，跟get的效果一样：<ul>
<li>在实体类中加final</li>
<li>在配置文件中的class标签上设置lazy属性为false</li>
</ul>
</li>
</ul>
<h4 id="2-1-2-关联级别的延迟加载"><a href="#2-1-2-关联级别的延迟加载" class="headerlink" title="2.1.2 关联级别的延迟加载"></a>2.1.2 关联级别的延迟加载</h4><p>关联级别的延迟加载：查询某个类以后，查询这个类的关联的对象的时候，关联对象是否采用延迟，默认为true是延迟加载。</p>
<ul>
<li>使关联级别的延迟加载失效：<ul>
<li>在实体类中加final</li>
<li>在配置文件中的set标签上设置lazy属性为false</li>
</ul>
</li>
</ul>
<p>lazy上还有一个值 <code>extra</code>，只是在关联级别有，及其懒惰，要什么只查什么。</p>
<h3 id="2-2Hibernate的抓取策略-关联关系上配置fetch属性"><a href="#2-2Hibernate的抓取策略-关联关系上配置fetch属性" class="headerlink" title="2.2Hibernate的抓取策略(关联关系上配置fetch属性)"></a>2.2Hibernate的抓取策略(关联关系上配置fetch属性)</h3><p>抓取策略：用来查询到一个对象之后抓取其关联对象。</p>
<h4 id="2-2-1set上的fetch和lazy："><a href="#2-2-1set上的fetch和lazy：" class="headerlink" title="2.2.1set上的fetch和lazy："></a>2.2.1set上的fetch和lazy：</h4><p>fetch控制的SQL语句的格式：<br>lazy控制关联对象是否一致被查询</p>
<ul>
<li>set集合上配置fetch属性：<ul>
<li>select     默认值，普通的select查询语句</li>
<li>join       会发送一条迫切连接，将关联的信息一起查询出来，所以此时lazy会失效</li>
<li>subselect  子查询 ，用 in</li>
</ul>
</li>
<li>set集合上配置lazy属性：<ul>
<li>true       默认值，延迟加载</li>
<li>false      不使用延迟加载</li>
<li>extra      及其懒惰</li>
</ul>
</li>
</ul>
<p><strong>一般情况下</strong>就用默认的，但是如果经常一查多的一方，可以fetch用join</p>
<h4 id="2-2-2-many-to-one-上的fetch和lazy："><a href="#2-2-2-many-to-one-上的fetch和lazy：" class="headerlink" title="2.2.2 many-to-one 上的fetch和lazy："></a>2.2.2 many-to-one 上的fetch和lazy：</h4><ul>
<li><p>many-to-one集合上配置fetch属性：</p>
<ul>
<li>select     默认值，普通的select查询语句</li>
<li>join       会发送一条迫切连接，将关联的信息一起查询出来，所以此时lazy会失效</li>
</ul>
</li>
<li><p>many-to-one集合上配置lazy属性：</p>
<ul>
<li>proxy       默认值，具体的取值取决于一的一方的类的fetch的值</li>
<li>false       不使用延迟加载</li>
<li>no-proxy</li>
</ul>
</li>
</ul>
<p><strong>一般情况下</strong>就用默认的</p>
<h3 id="2-3批量抓取"><a href="#2-3批量抓取" class="headerlink" title="2.3批量抓取"></a>2.3批量抓取</h3><ul>
<li><p><img src="/uploads/Hibernate/04/6.png" alt=""><br>本来是先查所有，在一个一个查查三个        发四条语句</p>
<p>在set上加一个<code>batch-size=&quot;3&quot;;</code>  一下查三个，共发2条语句</p>
</li>
</ul>
<ul>
<li>在many-to-one上没有batch-size，需要时要在一的一方的class上配</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="//schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/1.jpg"
               alt="zc" />
          <p class="site-author-name" itemprop="name">zc</p>
          <p class="site-description motion-element" itemprop="description">Life was like a box of chocolates, you never know what you’re gonna get.</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">15</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              Links
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://my.csdn.net/john_zc" title="csdn" target="_blank">csdn</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://github.com/markzc" title="GitHub" target="_blank">GitHub</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://weibo.com/3490969043" title="weibo" target="_blank">weibo</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zc</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.2"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.2"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"markzc"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = false;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = decodeURIComponent(data.url);
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title >= 0 || index_content >= 0 ){
                                isMatch = true;
								if (i == 0) {
                                    first_occur = index_content;
                                }
                            } 
							
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });

                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("22dObQGNrAe90ze3Kbtmu5hG-gzGzoHsz", "0j5eGtmDLCCURrOtIpv1gw2X");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  


</body>
</html>
